<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.11">
  <compounddef id="ll__ext__scan_8c" kind="file" language="C++">
    <compoundname>ll_ext_scan.c</compoundname>
    <includes refid="link__layer_8h" local="yes">ble/link_layer.h</includes>
    <includes local="yes">RF_ble.h</includes>
    <includes local="yes">hci_controller.h</includes>
    <includes local="yes">btcontroller_heap.h</includes>
    <includes local="yes">os/os_cpu.h</includes>
    <includes local="yes">common/debug.h</includes>
    <incdepgraph>
      <node id="3436">
        <label>os/os_type.h</label>
      </node>
      <node id="3432">
        <label>common/atomic.h</label>
      </node>
      <node id="3446">
        <label>common/lbuf.h</label>
      </node>
      <node id="3429">
        <label>common/list.h</label>
      </node>
      <node id="3435">
        <label>common/thread.h</label>
      </node>
      <node id="3438">
        <label>ble/ll_adv.h</label>
        <link refid="ll__adv_8h"/>
        <childnode refid="3430" relation="include">
        </childnode>
      </node>
      <node id="3455">
        <label>common/debug.h</label>
      </node>
      <node id="3440">
        <label>ble/ll_init.h</label>
        <link refid="ll__init_8h"/>
        <childnode refid="3430" relation="include">
        </childnode>
      </node>
      <node id="3442">
        <label>data_extension.h</label>
        <link refid="data__extension_8h"/>
        <childnode refid="3428" relation="include">
        </childnode>
      </node>
      <node id="3445">
        <label>ble/ll_iso.h</label>
        <link refid="ll__iso_8h"/>
        <childnode refid="3433" relation="include">
        </childnode>
        <childnode refid="3446" relation="include">
        </childnode>
        <childnode refid="3435" relation="include">
        </childnode>
      </node>
      <node id="3451">
        <label>RF_ble.h</label>
      </node>
      <node id="3428">
        <label>typedef.h</label>
      </node>
      <node id="3453">
        <label>btcontroller_heap.h</label>
      </node>
      <node id="3434">
        <label>white_list.h</label>
        <link refid="white__list_8h"/>
        <childnode refid="3428" relation="include">
        </childnode>
      </node>
      <node id="3448">
        <label>audio_codec.h</label>
        <link refid="audio__codec_8h"/>
        <childnode refid="3433" relation="include">
        </childnode>
      </node>
      <node id="3439">
        <label>ble/ll_scan.h</label>
        <link refid="ll__scan_8h"/>
        <childnode refid="3430" relation="include">
        </childnode>
      </node>
      <node id="3454">
        <label>os/os_cpu.h</label>
      </node>
      <node id="3437">
        <label>ble/llcp.h</label>
        <link refid="llcp_8h"/>
        <childnode refid="3428" relation="include">
        </childnode>
        <childnode refid="3433" relation="include">
        </childnode>
      </node>
      <node id="3443">
        <label>multiple_phys.h</label>
        <link refid="multiple__phys_8h"/>
        <childnode refid="3428" relation="include">
        </childnode>
      </node>
      <node id="3441">
        <label>resolve_list.h</label>
        <link refid="resolve__list_8h"/>
        <childnode refid="3428" relation="include">
        </childnode>
      </node>
      <node id="3430">
        <label>ble_interface.h</label>
      </node>
      <node id="3444">
        <label>ble/ll_cte.h</label>
        <link refid="ll__cte_8h"/>
        <childnode refid="3433" relation="include">
        </childnode>
      </node>
      <node id="3452">
        <label>hci_controller.h</label>
      </node>
      <node id="3431">
        <label>common/sys_timer.h</label>
      </node>
      <node id="3427">
        <label>ble/link_layer.h</label>
        <link refid="link__layer_8h"/>
        <childnode refid="3428" relation="include">
        </childnode>
        <childnode refid="3429" relation="include">
        </childnode>
        <childnode refid="3430" relation="include">
        </childnode>
        <childnode refid="3431" relation="include">
        </childnode>
        <childnode refid="3432" relation="include">
        </childnode>
        <childnode refid="3433" relation="include">
        </childnode>
        <childnode refid="3434" relation="include">
        </childnode>
        <childnode refid="3435" relation="include">
        </childnode>
        <childnode refid="3436" relation="include">
        </childnode>
        <childnode refid="3437" relation="include">
        </childnode>
        <childnode refid="3438" relation="include">
        </childnode>
        <childnode refid="3439" relation="include">
        </childnode>
        <childnode refid="3440" relation="include">
        </childnode>
        <childnode refid="3441" relation="include">
        </childnode>
        <childnode refid="3442" relation="include">
        </childnode>
        <childnode refid="3443" relation="include">
        </childnode>
        <childnode refid="3444" relation="include">
        </childnode>
        <childnode refid="3445" relation="include">
        </childnode>
        <childnode refid="3447" relation="include">
        </childnode>
        <childnode refid="3449" relation="include">
        </childnode>
        <childnode refid="3450" relation="include">
        </childnode>
      </node>
      <node id="3433">
        <label>ll_defines.h</label>
        <link refid="ll__defines_8h"/>
        <childnode refid="3428" relation="include">
        </childnode>
      </node>
      <node id="3449">
        <label>ble/ll_cis.h</label>
        <link refid="ll__cis_8h"/>
        <childnode refid="3445" relation="include">
        </childnode>
        <childnode refid="3427" relation="include">
        </childnode>
      </node>
      <node id="3426">
        <label>/data/bingquan/repo/repo_adapter/adapter_sdk/lib/btctrler/BLE_v2/ll_ext_scan.c</label>
        <link refid="ll_ext_scan.c"/>
        <childnode refid="3427" relation="include">
        </childnode>
        <childnode refid="3451" relation="include">
        </childnode>
        <childnode refid="3452" relation="include">
        </childnode>
        <childnode refid="3453" relation="include">
        </childnode>
        <childnode refid="3454" relation="include">
        </childnode>
        <childnode refid="3455" relation="include">
        </childnode>
      </node>
      <node id="3447">
        <label>ble/ll_bis.h</label>
        <link refid="ll__bis_8h"/>
        <childnode refid="3445" relation="include">
        </childnode>
        <childnode refid="3448" relation="include">
        </childnode>
      </node>
      <node id="3450">
        <label>ble/ll_pc.h</label>
        <link refid="ll__pc_8h"/>
        <childnode refid="3433" relation="include">
        </childnode>
      </node>
    </incdepgraph>
      <sectiondef kind="define">
      <memberdef kind="define" id="ll__ext__scan_8c_1a6c6991cba0e2995d7d9aec73e0324317" prot="public" static="no">
        <name>LOG_TAG_CONST</name>
        <initializer>LL_EXT_SCAN</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/data/bingquan/repo/repo_adapter/adapter_sdk/lib/btctrler/BLE_v2/ll_ext_scan.c" line="7" column="9" bodyfile="/data/bingquan/repo/repo_adapter/adapter_sdk/lib/btctrler/BLE_v2/ll_ext_scan.c" bodystart="7" bodyend="-1"/>
      </memberdef>
      <memberdef kind="define" id="ll__ext__scan_8c_1a7ce0df38eb467e59f209470c8f5ac4e6" prot="public" static="no">
        <name>LOG_TAG</name>
        <initializer>&quot;[LL-Ext SCAN]&quot;</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/data/bingquan/repo/repo_adapter/adapter_sdk/lib/btctrler/BLE_v2/ll_ext_scan.c" line="8" column="9" bodyfile="/data/bingquan/repo/repo_adapter/adapter_sdk/lib/btctrler/BLE_v2/ll_ext_scan.c" bodystart="8" bodyend="-1"/>
      </memberdef>
      <memberdef kind="define" id="ll__ext__scan_8c_1a9eeb6e067100d0dec6e53bce19a403e0" prot="public" static="no">
        <name>LOG_ERROR_ENABLE</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/data/bingquan/repo/repo_adapter/adapter_sdk/lib/btctrler/BLE_v2/ll_ext_scan.c" line="9" column="9" bodyfile="/data/bingquan/repo/repo_adapter/adapter_sdk/lib/btctrler/BLE_v2/ll_ext_scan.c" bodystart="9" bodyend="-1"/>
      </memberdef>
      <memberdef kind="define" id="ll__ext__scan_8c_1a69321c8a2a0b07a07fb5088e82e25eb0" prot="public" static="no">
        <name>LOG_INFO_ENABLE</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/data/bingquan/repo/repo_adapter/adapter_sdk/lib/btctrler/BLE_v2/ll_ext_scan.c" line="10" column="9" bodyfile="/data/bingquan/repo/repo_adapter/adapter_sdk/lib/btctrler/BLE_v2/ll_ext_scan.c" bodystart="10" bodyend="-1"/>
      </memberdef>
      <memberdef kind="define" id="ll__ext__scan_8c_1a04135f631fe91199f05b1d816dda8756" prot="public" static="no">
        <name>LOG_DUMP_ENABLE</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/data/bingquan/repo/repo_adapter/adapter_sdk/lib/btctrler/BLE_v2/ll_ext_scan.c" line="11" column="9" bodyfile="/data/bingquan/repo/repo_adapter/adapter_sdk/lib/btctrler/BLE_v2/ll_ext_scan.c" bodystart="11" bodyend="-1"/>
      </memberdef>
      <memberdef kind="define" id="ll__ext__scan_8c_1a163fc974f6617f7f5c44dec8f5390964" prot="public" static="no">
        <name>AT_BLE5_LL_CODE</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/data/bingquan/repo/repo_adapter/adapter_sdk/lib/btctrler/BLE_v2/ll_ext_scan.c" line="21" column="9" bodyfile="/data/bingquan/repo/repo_adapter/adapter_sdk/lib/btctrler/BLE_v2/ll_ext_scan.c" bodystart="21" bodyend="-1"/>
      </memberdef>
      <memberdef kind="define" id="ll__ext__scan_8c_1a533eccbb5f4284123f0ba67115b0a883" prot="public" static="no">
        <name>AT_BLE5_LL_PROBE_CODE</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/data/bingquan/repo/repo_adapter/adapter_sdk/lib/btctrler/BLE_v2/ll_ext_scan.c" line="22" column="9" bodyfile="/data/bingquan/repo/repo_adapter/adapter_sdk/lib/btctrler/BLE_v2/ll_ext_scan.c" bodystart="22" bodyend="-1"/>
      </memberdef>
      </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="preprocessor">#include<sp/>&quot;<ref refid="link__layer_8h" kindref="compound">ble/link_layer.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;RF_ble.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;hci_controller.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="4"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;btcontroller_heap.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="5"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;os/os_cpu.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="6"><highlight class="normal"></highlight></codeline>
<codeline lineno="7"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>LOG_TAG_CONST<sp/><sp/><sp/><sp/><sp/><sp/><sp/>LL_EXT_SCAN</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="8"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>LOG_TAG<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&quot;[LL-Ext<sp/>SCAN]&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="9"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>LOG_ERROR_ENABLE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="10"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>LOG_INFO_ENABLE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="11"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>LOG_DUMP_ENABLE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="12"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;common/debug.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="13"><highlight class="normal"></highlight></codeline>
<codeline lineno="14"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>SUPPORT_MS_EXTENSIONS</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="15"><highlight class="normal"></highlight><highlight class="preprocessor">#pragma<sp/>bss_seg(&quot;.ble_ll_bss&quot;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="16"><highlight class="normal"></highlight><highlight class="preprocessor">#pragma<sp/>data_seg(&quot;.ble_ll_data&quot;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="17"><highlight class="normal"></highlight><highlight class="preprocessor">#pragma<sp/>const_seg(&quot;.ble_ll_const&quot;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="18"><highlight class="normal"></highlight><highlight class="preprocessor">#pragma<sp/>code_seg(&quot;.ble_ll_code&quot;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="19"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="20"><highlight class="normal"></highlight></codeline>
<codeline lineno="21"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>AT_BLE5_LL_CODE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="22"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>AT_BLE5_LL_PROBE_CODE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="23"><highlight class="normal"></highlight></codeline>
<codeline lineno="24"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>BLUETOOTH_5</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="25"><highlight class="normal"></highlight></codeline>
<codeline lineno="26"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>HAVE_MALLOC</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="27"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>__ext_this<sp/><sp/><sp/><sp/><sp/><sp/>(ext_ll_hdl)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="28"><highlight class="normal"></highlight><highlight class="preprocessor">#else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="29"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>__ext_this<sp/><sp/><sp/><sp/><sp/><sp/>(&amp;ext_ll_hdl)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="30"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="31"><highlight class="normal"></highlight></codeline>
<codeline lineno="32"><highlight class="normal"></highlight><highlight class="comment">//&lt;<sp/>external<sp/>file<sp/>declaration</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="33"><highlight class="normal"></highlight><highlight class="keyword">extern</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>le_extended_advertising_report_event(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="struct____ext__adv__report__event" kindref="compound">__ext_adv_report_event</ref><sp/>*report,<sp/>u8<sp/>*Data);</highlight></codeline>
<codeline lineno="34"><highlight class="normal"></highlight><highlight class="keyword">extern</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>le_scan_timeout_event(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="35"><highlight class="normal"></highlight></codeline>
<codeline lineno="36"><highlight class="normal"></highlight><highlight class="comment">//&lt;<sp/>local<sp/>file<sp/>declaration</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="37"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>ll_ext_scan_rx_probe_handler(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*priv,<sp/></highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/>ble_ext_rx<sp/>*rx);</highlight></codeline>
<codeline lineno="38"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ll_ext_scan_timeout_start(u32<sp/>timeout);</highlight></codeline>
<codeline lineno="39"><highlight class="normal"></highlight></codeline>
<codeline lineno="40"><highlight class="normal"><ref refid="ll__ext__scan_8c_1a533eccbb5f4284123f0ba67115b0a883" kindref="member">AT_BLE5_LL_PROBE_CODE</ref></highlight></codeline>
<codeline lineno="41"><highlight class="normal"></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">ble_ext_handler<sp/>ll_ext_scan_handler<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="42"><highlight class="normal"><sp/><sp/><sp/><sp/>.ext_rx_probe_handler<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>ll_ext_scan_rx_probe_handler,</highlight></codeline>
<codeline lineno="43"><highlight class="normal">};</highlight></codeline>
<codeline lineno="44"><highlight class="normal"></highlight></codeline>
<codeline lineno="45"><highlight class="normal"><ref refid="ll__ext__scan_8c_1a533eccbb5f4284123f0ba67115b0a883" kindref="member">AT_BLE5_LL_PROBE_CODE</ref></highlight></codeline>
<codeline lineno="46"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>ll_ext_scan_rx_probe_handler(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*priv,<sp/></highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/>ble_ext_rx<sp/>*rx)</highlight></codeline>
<codeline lineno="47"><highlight class="normal">{</highlight></codeline>
<codeline lineno="48"><highlight class="normal"><sp/><sp/><sp/><sp/>LE_ROLES_IS_SUPPORT_OPTIMIZE(LE_MASTER);</highlight></codeline>
<codeline lineno="49"><highlight class="normal"></highlight></codeline>
<codeline lineno="50"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//&lt;<sp/>empty<sp/>packet<sp/>not<sp/>notify<sp/>to<sp/>upper<sp/>layer</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="51"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(EXT_RX_PACKET_IS_VALID(rx))<sp/>{</highlight></codeline>
<codeline lineno="52"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//&lt;<sp/>resume<sp/>ll<sp/>thread</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="53"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="link__layer_8c_1af5e4ac77575bf70aae9293b0c2925f61" kindref="member">ll_thread_resume</ref>();</highlight></codeline>
<codeline lineno="54"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="55"><highlight class="normal">}</highlight></codeline>
<codeline lineno="56"><highlight class="normal"></highlight></codeline>
<codeline lineno="57"><highlight class="normal"><ref refid="ll__ext__scan_8c_1a163fc974f6617f7f5c44dec8f5390964" kindref="member">AT_BLE5_LL_CODE</ref></highlight></codeline>
<codeline lineno="58"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>u8<sp/>build_ext_primary_adv_report(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structle__ext__scan__link" kindref="compound">le_ext_scan_link</ref><sp/>*link,<sp/></highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/>ble_ext_rx<sp/>*rx,<sp/>u8<sp/>*adv_data_offset)</highlight></codeline>
<codeline lineno="59"><highlight class="normal">{</highlight></codeline>
<codeline lineno="60"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structle__ext__adv__report" kindref="compound">le_ext_adv_report</ref><sp/>*report<sp/>=<sp/>&amp;link-&gt;<ref refid="structle__ext__scan__link_1a5e817b5ba0949889b86d1b13e0b36cb1" kindref="member">ext_adv_report</ref>;</highlight></codeline>
<codeline lineno="61"><highlight class="normal"><sp/><sp/><sp/><sp/>*adv_data_offset<sp/>=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(report-&gt;<ref refid="structle__ext__adv__report_1a5258855e162cee869cb31d363aae3aeb" kindref="member">address</ref>);</highlight></codeline>
<codeline lineno="62"><highlight class="normal"></highlight></codeline>
<codeline lineno="63"><highlight class="normal"><sp/><sp/><sp/><sp/>memset(&amp;report-&gt;<ref refid="structle__ext__adv__report_1ad0be59bf450c185a6b76136fc698add9" kindref="member">direct_address</ref>,<sp/>0,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(*report)<sp/>-<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(report-&gt;<ref refid="structle__ext__adv__report_1ae7c314a0b5f87a827f1bb13c8083e433" kindref="member">event_type</ref>)<sp/>-<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(report-&gt;<ref refid="structle__ext__adv__report_1a5258855e162cee869cb31d363aae3aeb" kindref="member">address</ref>));</highlight></codeline>
<codeline lineno="64"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">switch</highlight><highlight class="normal"><sp/>(rx-&gt;type)<sp/>{</highlight></codeline>
<codeline lineno="65"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="ll__defines_8h_1a16685eea158879e41b101ca3634de462ab191c3ea1fcc932499c8c469c75a5568" kindref="member">LL_PDU_ADV_IND</ref>:</highlight></codeline>
<codeline lineno="66"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>report-&gt;<ref refid="structle__ext__adv__report_1ae7c314a0b5f87a827f1bb13c8083e433" kindref="member">event_type</ref><sp/>=<sp/>BIT(<ref refid="ll__ext__scan_8h_1a8f5e0748087b87d63826c26de3e9ab94a491a3dd7c0cdad7d591db104e73508ff" kindref="member">REPORT_LEGACY_ADV</ref>)<sp/>|<sp/>BIT(<ref refid="ll__ext__scan_8h_1a8f5e0748087b87d63826c26de3e9ab94a0942121ad971374a0a42662db4e9ccdd" kindref="member">REPORT_CONNECTABLE_ADV</ref>)<sp/>|<sp/>BIT(<ref refid="ll__ext__scan_8h_1a8f5e0748087b87d63826c26de3e9ab94a22e2f447fdae8ae5ed8084bec1c5f557" kindref="member">REPORT_SCANNABLE_ADV</ref>);</highlight></codeline>
<codeline lineno="67"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>memcpy(report-&gt;<ref refid="structle__ext__adv__report_1a5258855e162cee869cb31d363aae3aeb" kindref="member">address</ref>,<sp/>&amp;rx-&gt;data[0],<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(report-&gt;<ref refid="structle__ext__adv__report_1a5258855e162cee869cb31d363aae3aeb" kindref="member">address</ref>));</highlight></codeline>
<codeline lineno="68"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="69"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>ADV_DIRECT_IND:</highlight></codeline>
<codeline lineno="70"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//&lt;<sp/>aviod<sp/>invalid<sp/>TargetA</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="71"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(memcmp(&amp;rx-&gt;data[</highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(report-&gt;<ref refid="structle__ext__adv__report_1a5258855e162cee869cb31d363aae3aeb" kindref="member">address</ref>)],<sp/>link-&gt;<ref refid="structle__ext__scan__link_1a1f599a5a3aefab84126e1a5e350ca656" kindref="member">extended_scan</ref>.addr.addr,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(report-&gt;<ref refid="structle__ext__adv__report_1ad0be59bf450c185a6b76136fc698add9" kindref="member">direct_address</ref>)))<sp/>{</highlight></codeline>
<codeline lineno="72"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="73"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="74"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>report-&gt;<ref refid="structle__ext__adv__report_1ae7c314a0b5f87a827f1bb13c8083e433" kindref="member">event_type</ref><sp/>=<sp/>BIT(<ref refid="ll__ext__scan_8h_1a8f5e0748087b87d63826c26de3e9ab94a491a3dd7c0cdad7d591db104e73508ff" kindref="member">REPORT_LEGACY_ADV</ref>)<sp/>|<sp/>BIT(<ref refid="ll__ext__scan_8h_1a8f5e0748087b87d63826c26de3e9ab94a0942121ad971374a0a42662db4e9ccdd" kindref="member">REPORT_CONNECTABLE_ADV</ref>)<sp/>|<sp/>BIT(<ref refid="ll__ext__scan_8h_1a8f5e0748087b87d63826c26de3e9ab94aeebedd486df2e1f5a4a2202dbd14a816" kindref="member">REPORT_DIRECTED_ADV</ref>);</highlight></codeline>
<codeline lineno="75"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>memcpy(report-&gt;<ref refid="structle__ext__adv__report_1a5258855e162cee869cb31d363aae3aeb" kindref="member">address</ref>,<sp/>&amp;rx-&gt;data[0],<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(report-&gt;<ref refid="structle__ext__adv__report_1a5258855e162cee869cb31d363aae3aeb" kindref="member">address</ref>));</highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>memcpy(report-&gt;<ref refid="structle__ext__adv__report_1ad0be59bf450c185a6b76136fc698add9" kindref="member">direct_address</ref>,<sp/>&amp;rx-&gt;data[</highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(report-&gt;<ref refid="structle__ext__adv__report_1a5258855e162cee869cb31d363aae3aeb" kindref="member">address</ref>)],<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(report-&gt;<ref refid="structle__ext__adv__report_1ad0be59bf450c185a6b76136fc698add9" kindref="member">direct_address</ref>));</highlight></codeline>
<codeline lineno="77"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*adv_data_offset<sp/>+=<sp/><sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(report-&gt;<ref refid="structle__ext__adv__report_1a5258855e162cee869cb31d363aae3aeb" kindref="member">address</ref>);</highlight></codeline>
<codeline lineno="78"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="79"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>ADV_NONCONN_IND:</highlight></codeline>
<codeline lineno="80"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>report-&gt;<ref refid="structle__ext__adv__report_1ae7c314a0b5f87a827f1bb13c8083e433" kindref="member">event_type</ref><sp/>=<sp/>BIT(<ref refid="ll__ext__scan_8h_1a8f5e0748087b87d63826c26de3e9ab94a491a3dd7c0cdad7d591db104e73508ff" kindref="member">REPORT_LEGACY_ADV</ref>);</highlight></codeline>
<codeline lineno="81"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>memcpy(report-&gt;<ref refid="structle__ext__adv__report_1a5258855e162cee869cb31d363aae3aeb" kindref="member">address</ref>,<sp/>&amp;rx-&gt;data[0],<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(report-&gt;<ref refid="structle__ext__adv__report_1a5258855e162cee869cb31d363aae3aeb" kindref="member">address</ref>));</highlight></codeline>
<codeline lineno="82"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="83"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>ADV_SCAN_IND:</highlight></codeline>
<codeline lineno="84"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>report-&gt;<ref refid="structle__ext__adv__report_1ae7c314a0b5f87a827f1bb13c8083e433" kindref="member">event_type</ref><sp/>=<sp/>BIT(<ref refid="ll__ext__scan_8h_1a8f5e0748087b87d63826c26de3e9ab94a491a3dd7c0cdad7d591db104e73508ff" kindref="member">REPORT_LEGACY_ADV</ref>)<sp/>|<sp/>BIT(<ref refid="ll__ext__scan_8h_1a8f5e0748087b87d63826c26de3e9ab94a22e2f447fdae8ae5ed8084bec1c5f557" kindref="member">REPORT_SCANNABLE_ADV</ref>);</highlight></codeline>
<codeline lineno="85"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>memcpy(report-&gt;<ref refid="structle__ext__adv__report_1a5258855e162cee869cb31d363aae3aeb" kindref="member">address</ref>,<sp/>&amp;rx-&gt;data[0],<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(report-&gt;<ref refid="structle__ext__adv__report_1a5258855e162cee869cb31d363aae3aeb" kindref="member">address</ref>));</highlight></codeline>
<codeline lineno="86"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="87"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>SCAN_RSP:</highlight></codeline>
<codeline lineno="88"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//&lt;<sp/>aviod<sp/>the<sp/>consecutive<sp/>SCAN_RSP</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="89"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(report-&gt;<ref refid="structle__ext__adv__report_1ae7c314a0b5f87a827f1bb13c8083e433" kindref="member">event_type</ref><sp/>&amp;<sp/>BIT(<ref refid="ll__ext__scan_8h_1a8f5e0748087b87d63826c26de3e9ab94ac2b98df6f424919de4036e3e0814020f" kindref="member">REPORT_SCAN_RSP</ref>))<sp/>{</highlight></codeline>
<codeline lineno="90"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="92"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//&lt;<sp/>aviod<sp/>the<sp/>different<sp/>adv</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(memcmp(report-&gt;<ref refid="structle__ext__adv__report_1a5258855e162cee869cb31d363aae3aeb" kindref="member">address</ref>,<sp/>rx-&gt;data,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(report-&gt;<ref refid="structle__ext__adv__report_1a5258855e162cee869cb31d363aae3aeb" kindref="member">address</ref>)))<sp/>{</highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="95"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="96"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(report-&gt;<ref refid="structle__ext__adv__report_1ae7c314a0b5f87a827f1bb13c8083e433" kindref="member">event_type</ref><sp/>&amp;<sp/>BIT(<ref refid="ll__ext__scan_8h_1a8f5e0748087b87d63826c26de3e9ab94a0942121ad971374a0a42662db4e9ccdd" kindref="member">REPORT_CONNECTABLE_ADV</ref>))<sp/>{</highlight></codeline>
<codeline lineno="97"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>report-&gt;<ref refid="structle__ext__adv__report_1ae7c314a0b5f87a827f1bb13c8083e433" kindref="member">event_type</ref><sp/>=<sp/>BIT(<ref refid="ll__ext__scan_8h_1a8f5e0748087b87d63826c26de3e9ab94a491a3dd7c0cdad7d591db104e73508ff" kindref="member">REPORT_LEGACY_ADV</ref>)<sp/>|<sp/>BIT(<ref refid="ll__ext__scan_8h_1a8f5e0748087b87d63826c26de3e9ab94ac2b98df6f424919de4036e3e0814020f" kindref="member">REPORT_SCAN_RSP</ref>)<sp/>|<sp/>\</highlight></codeline>
<codeline lineno="98"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>BIT(<ref refid="ll__ext__scan_8h_1a8f5e0748087b87d63826c26de3e9ab94a22e2f447fdae8ae5ed8084bec1c5f557" kindref="member">REPORT_SCANNABLE_ADV</ref>)<sp/>|<sp/>BIT(<ref refid="ll__ext__scan_8h_1a8f5e0748087b87d63826c26de3e9ab94a0942121ad971374a0a42662db4e9ccdd" kindref="member">REPORT_CONNECTABLE_ADV</ref>);</highlight></codeline>
<codeline lineno="99"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="100"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>report-&gt;<ref refid="structle__ext__adv__report_1ae7c314a0b5f87a827f1bb13c8083e433" kindref="member">event_type</ref><sp/>=<sp/>BIT(<ref refid="ll__ext__scan_8h_1a8f5e0748087b87d63826c26de3e9ab94a491a3dd7c0cdad7d591db104e73508ff" kindref="member">REPORT_LEGACY_ADV</ref>)<sp/>|<sp/>BIT(<ref refid="ll__ext__scan_8h_1a8f5e0748087b87d63826c26de3e9ab94ac2b98df6f424919de4036e3e0814020f" kindref="member">REPORT_SCAN_RSP</ref>)<sp/>|<sp/>\</highlight></codeline>
<codeline lineno="101"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>BIT(<ref refid="ll__ext__scan_8h_1a8f5e0748087b87d63826c26de3e9ab94a22e2f447fdae8ae5ed8084bec1c5f557" kindref="member">REPORT_SCANNABLE_ADV</ref>);</highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="103"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>memcpy(report-&gt;<ref refid="structle__ext__adv__report_1a5258855e162cee869cb31d363aae3aeb" kindref="member">address</ref>,<sp/>&amp;rx-&gt;data[0],<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(report-&gt;<ref refid="structle__ext__adv__report_1a5258855e162cee869cb31d363aae3aeb" kindref="member">address</ref>));</highlight></codeline>
<codeline lineno="104"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="105"><highlight class="normal"></highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>ADV_EXT_IND:</highlight></codeline>
<codeline lineno="107"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>u8<sp/>ext_flag<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="108"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ext_adv_hdr_t<sp/>ext_adv_hdr<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="109"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.ext_hdr_len<sp/>=<sp/>rx-&gt;data[0]<sp/>&amp;<sp/>EXT_HEADER_LEN_MASK,</highlight></codeline>
<codeline lineno="110"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>};</highlight></codeline>
<codeline lineno="111"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>report-&gt;<ref refid="structle__ext__adv__report_1ae7c314a0b5f87a827f1bb13c8083e433" kindref="member">event_type</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="112"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ext_adv_hdr.ext_hdr_len)<sp/>{</highlight></codeline>
<codeline lineno="113"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ext_flag<sp/>=<sp/>rx-&gt;data[1];</highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ext_flag<sp/>&amp;<sp/>FLAG_TARGETA)<sp/>{</highlight></codeline>
<codeline lineno="115"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="ll__ext__scan_8h_1afa8428cfa3a9fb61b026d517abd908e4" kindref="member">MAKE_REPORT</ref>(FLAG_TARGETA,<sp/>&amp;report-&gt;<ref refid="structle__ext__adv__report_1ad0be59bf450c185a6b76136fc698add9" kindref="member">direct_address</ref>);</highlight></codeline>
<codeline lineno="116"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//&lt;<sp/>aviod<sp/>invalid<sp/>TargetA</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(memcmp(&amp;report-&gt;<ref refid="structle__ext__adv__report_1ad0be59bf450c185a6b76136fc698add9" kindref="member">direct_address</ref>,<sp/>link-&gt;<ref refid="structle__ext__scan__link_1a1f599a5a3aefab84126e1a5e350ca656" kindref="member">extended_scan</ref>.addr.addr,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(report-&gt;<ref refid="structle__ext__adv__report_1ad0be59bf450c185a6b76136fc698add9" kindref="member">direct_address</ref>)))<sp/>{</highlight></codeline>
<codeline lineno="118"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="120"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="121"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="ll__ext__scan_8h_1afa8428cfa3a9fb61b026d517abd908e4" kindref="member">MAKE_REPORT</ref>(FLAG_ADVA,<sp/>&amp;report-&gt;<ref refid="structle__ext__adv__report_1a5258855e162cee869cb31d363aae3aeb" kindref="member">address</ref>);</highlight></codeline>
<codeline lineno="122"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="123"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*adv_data_offset<sp/>=<sp/><ref refid="ll__defines_8h_1a9fa287ceebff434e4c8b4d2803355bcd" kindref="member">LL_EXT_ADV_HDR_MIN_LEN</ref><sp/>+<sp/>ext_adv_hdr.ext_hdr_len;</highlight></codeline>
<codeline lineno="124"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="125"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">default</highlight><highlight class="normal"><sp/>:</highlight></codeline>
<codeline lineno="126"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="ll__ext__scan_8h_1a31edb8834d915e6d288298493ba1c6b7" kindref="member">SET_BIT</ref>(report-&gt;<ref refid="structle__ext__adv__report_1ae7c314a0b5f87a827f1bb13c8083e433" kindref="member">event_type</ref>,<sp/>5,<sp/>2,<sp/>DATA_COMPLETE);</highlight></codeline>
<codeline lineno="129"><highlight class="normal"><sp/><sp/><sp/><sp/>rx-&gt;secondary_phy<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="130"><highlight class="normal"></highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>TRUE;</highlight></codeline>
<codeline lineno="132"><highlight class="normal">}</highlight></codeline>
<codeline lineno="133"><highlight class="normal"></highlight></codeline>
<codeline lineno="134"><highlight class="normal"><ref refid="ll__ext__scan_8c_1a163fc974f6617f7f5c44dec8f5390964" kindref="member">AT_BLE5_LL_CODE</ref></highlight></codeline>
<codeline lineno="135"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>le_ext_adv_report_event_generate(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structle__ext__scan__link" kindref="compound">le_ext_scan_link</ref><sp/>*link,<sp/></highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/>ble_ext_rx<sp/>*rx,<sp/>u8<sp/>offset)</highlight></codeline>
<codeline lineno="136"><highlight class="normal">{</highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/><sp/><sp/>u8<sp/>upload_length<sp/>=<sp/>rx-&gt;len<sp/>-<sp/>offset;</highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/><sp/><sp/>u8<sp/>*Data<sp/>=<sp/>&amp;rx-&gt;data[offset];</highlight></codeline>
<codeline lineno="139"><highlight class="normal"></highlight></codeline>
<codeline lineno="140"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="struct____ext__adv__report__event" kindref="compound">__ext_adv_report_event</ref><sp/>report<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="141"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.Subevent_Code<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>HCI_SUBEVENT_LE_EXTENDED_ADVERTISING_REPORT,</highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.Num_Reports<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>1,</highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.Event_Type.<ref refid="structle__ext__adv__report_1ae7c314a0b5f87a827f1bb13c8083e433" kindref="member">event_type</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>link-&gt;<ref refid="structle__ext__scan__link_1a5e817b5ba0949889b86d1b13e0b36cb1" kindref="member">ext_adv_report</ref>.<ref refid="structle__ext__adv__report_1ae7c314a0b5f87a827f1bb13c8083e433" kindref="member">event_type</ref>,</highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.Address_Type<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>rx-&gt;txadd,</highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.Primary_PHY<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>rx-&gt;primary_phy,</highlight></codeline>
<codeline lineno="146"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.Secondary_PHY<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>rx-&gt;secondary_phy,</highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.Advertising_SID<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>link-&gt;<ref refid="structle__ext__scan__link_1a5e817b5ba0949889b86d1b13e0b36cb1" kindref="member">ext_adv_report</ref>.<ref refid="structle__ext__adv__report_1a6a5e8bfd5dee48062ee3c1f919bd23bc" kindref="member">advertising_adi</ref><sp/>&gt;&gt;<sp/>12,</highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.Tx_Power<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>link-&gt;<ref refid="structle__ext__scan__link_1a5e817b5ba0949889b86d1b13e0b36cb1" kindref="member">ext_adv_report</ref>.<ref refid="structle__ext__adv__report_1aa6eaae2ee50ad78f66efcc1b95f29daa" kindref="member">tx_power</ref>,</highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.RSSI<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>rx-&gt;rssi,</highlight></codeline>
<codeline lineno="150"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.Periodic_Advertising_Interval<sp/><sp/>=<sp/>link-&gt;<ref refid="structle__ext__scan__link_1a5e817b5ba0949889b86d1b13e0b36cb1" kindref="member">ext_adv_report</ref>.<ref refid="structle__ext__adv__report_1a6299f19426dabcc1a728d56d9d855de0" kindref="member">periodic_adv_interval</ref>,</highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.Direct_Address_Type<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>rx-&gt;rxadd,</highlight></codeline>
<codeline lineno="152"><highlight class="normal"><sp/><sp/><sp/><sp/>};</highlight></codeline>
<codeline lineno="153"><highlight class="normal"></highlight></codeline>
<codeline lineno="154"><highlight class="normal"><sp/><sp/><sp/><sp/>memcpy(report.<ref refid="struct____ext__adv__report__event_1a970a5b8d609f3cdc5272a800c8a814bc" kindref="member">Address</ref>,<sp/>link-&gt;<ref refid="structle__ext__scan__link_1a5e817b5ba0949889b86d1b13e0b36cb1" kindref="member">ext_adv_report</ref>.<ref refid="structle__ext__adv__report_1a5258855e162cee869cb31d363aae3aeb" kindref="member">address</ref>,<sp/>6);</highlight></codeline>
<codeline lineno="155"><highlight class="normal"></highlight></codeline>
<codeline lineno="156"><highlight class="normal"><sp/><sp/><sp/><sp/>memcpy(report.<ref refid="struct____ext__adv__report__event_1ad61e5614ecbc4eecffc71b1a46e54465" kindref="member">Direct_Address</ref>,<sp/>link-&gt;<ref refid="structle__ext__scan__link_1a5e817b5ba0949889b86d1b13e0b36cb1" kindref="member">ext_adv_report</ref>.<ref refid="structle__ext__adv__report_1ad0be59bf450c185a6b76136fc698add9" kindref="member">direct_address</ref>,<sp/>6);</highlight></codeline>
<codeline lineno="157"><highlight class="normal"></highlight></codeline>
<codeline lineno="158"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="159"><highlight class="normal"></highlight></codeline>
<codeline lineno="160"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(upload_length<sp/>&gt;<sp/><ref refid="ll__ext__scan_8h_1aa94aeb30150d5436d38dd0b2aef2fc27" kindref="member">EXT_REPORT_EVENT_MAX_DATA_LEN</ref>)<sp/>{</highlight></codeline>
<codeline lineno="161"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>report.<ref refid="struct____ext__adv__report__event_1a523f235fbcb328b645b3c6cc8fc47668" kindref="member">Data_Length</ref><sp/>=<sp/><ref refid="ll__ext__scan_8h_1aa94aeb30150d5436d38dd0b2aef2fc27" kindref="member">EXT_REPORT_EVENT_MAX_DATA_LEN</ref>;</highlight></codeline>
<codeline lineno="162"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>report.<ref refid="struct____ext__adv__report__event_1ace7eaf15d00e906496b05ede1d9b99f0" kindref="member">Event_Type</ref>.Data_status<sp/>=<sp/>DATA_MORE_COME;</highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="164"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>report.<ref refid="struct____ext__adv__report__event_1a523f235fbcb328b645b3c6cc8fc47668" kindref="member">Data_Length</ref><sp/>=<sp/>upload_length;</highlight></codeline>
<codeline lineno="165"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>report.<ref refid="struct____ext__adv__report__event_1ace7eaf15d00e906496b05ede1d9b99f0" kindref="member">Event_Type</ref>.<ref refid="union____ExtAdv__EventType_1affb2636c8d80af4395c50954f048c78b" kindref="member">event_type</ref><sp/>=<sp/>link-&gt;<ref refid="structle__ext__scan__link_1a5e817b5ba0949889b86d1b13e0b36cb1" kindref="member">ext_adv_report</ref>.<ref refid="structle__ext__adv__report_1ae7c314a0b5f87a827f1bb13c8083e433" kindref="member">event_type</ref>;</highlight></codeline>
<codeline lineno="166"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="167"><highlight class="normal"></highlight></codeline>
<codeline lineno="168"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>le_extended_advertising_report_event(&amp;report,<sp/>Data);</highlight></codeline>
<codeline lineno="169"><highlight class="normal"></highlight></codeline>
<codeline lineno="170"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Data<sp/>+=<sp/>report.<ref refid="struct____ext__adv__report__event_1a523f235fbcb328b645b3c6cc8fc47668" kindref="member">Data_Length</ref>;</highlight></codeline>
<codeline lineno="171"><highlight class="normal"></highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>upload_length<sp/>-=<sp/>report.<ref refid="struct____ext__adv__report__event_1a523f235fbcb328b645b3c6cc8fc47668" kindref="member">Data_Length</ref>;</highlight></codeline>
<codeline lineno="173"><highlight class="normal"></highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(upload_length);</highlight></codeline>
<codeline lineno="175"><highlight class="normal">}</highlight></codeline>
<codeline lineno="176"><highlight class="normal"></highlight></codeline>
<codeline lineno="177"><highlight class="normal"><ref refid="ll__ext__scan_8c_1a163fc974f6617f7f5c44dec8f5390964" kindref="member">AT_BLE5_LL_CODE</ref></highlight></codeline>
<codeline lineno="178"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>le_ext_adv_report_event_handle(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structle__ext__scan__link" kindref="compound">le_ext_scan_link</ref><sp/>*link,<sp/></highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/>ble_ext_rx<sp/>*rx)</highlight></codeline>
<codeline lineno="179"><highlight class="normal">{</highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">__SyncInfo_field<sp/>sync_info;</highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/><sp/><sp/>u8<sp/>offset<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/><sp/><sp/>u8<sp/>ext_flag<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/><sp/><sp/>u8<sp/>res<sp/>=<sp/>FALSE;</highlight></codeline>
<codeline lineno="184"><highlight class="normal"></highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(rx-&gt;data_status<sp/>&amp;<sp/>BIT(DATA_PRIMARY_ADV))<sp/>{</highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>res<sp/>=<sp/>build_ext_primary_adv_report(link,<sp/>rx,<sp/>&amp;offset);</highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(rx-&gt;data_status<sp/>&amp;<sp/>BIT(DATA_PRIMARY_ADV_INFO))<sp/>{</highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="ll__ext__scan_8h_1a221c4b601e98bc1d1ca824ebb153c862" kindref="member">build_ext_aux_adv_report</ref>(link,<sp/>rx,<sp/>&amp;offset);<sp/></highlight><highlight class="comment">//<sp/>just<sp/>update<sp/>ext<sp/>header<sp/>info</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>res<sp/>=<sp/><ref refid="ll__ext__scan_8h_1a221c4b601e98bc1d1ca824ebb153c862" kindref="member">build_ext_aux_adv_report</ref>(link,<sp/>rx,<sp/>&amp;offset);</highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="ll__ext__scan_8h_1a77eb2e1fc1adf9d966a9b49cf8739a09" kindref="member">GET_SYNC_INFO</ref>();<sp/></highlight><highlight class="comment">//<sp/>get<sp/>the<sp/>periodic_adv_interval</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="194"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(TRUE<sp/>==<sp/>res)<sp/>{</highlight></codeline>
<codeline lineno="195"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>le_ext_adv_report_event_generate(link,<sp/>rx,<sp/>offset);</highlight></codeline>
<codeline lineno="196"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="197"><highlight class="normal"></highlight></codeline>
<codeline lineno="198"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!(ext_flag<sp/>&amp;<sp/>FLAG_SYNCINFO))<sp/>{</highlight></codeline>
<codeline lineno="199"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="201"><highlight class="normal"></highlight></codeline>
<codeline lineno="202"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">ble_ext_period_sync<sp/>*sync<sp/>=<sp/>link-&gt;<ref refid="structle__ext__scan__link_1a2c24ea1b469c7e40bd1fb3a818ba1726" kindref="member">period_sync</ref>;</highlight></codeline>
<codeline lineno="203"><highlight class="normal"></highlight></codeline>
<codeline lineno="204"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(sync)<sp/>{</highlight></codeline>
<codeline lineno="205"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">__periodic_adv_list<sp/>list;</highlight></codeline>
<codeline lineno="206"><highlight class="normal"></highlight></codeline>
<codeline lineno="207"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>list.Advertiser_Address_Type<sp/><sp/><sp/><sp/>=<sp/>rx-&gt;rxadd;</highlight></codeline>
<codeline lineno="208"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>list.Advertising_SID<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>link-&gt;<ref refid="structle__ext__scan__link_1a5e817b5ba0949889b86d1b13e0b36cb1" kindref="member">ext_adv_report</ref>.<ref refid="structle__ext__adv__report_1a6a5e8bfd5dee48062ee3c1f919bd23bc" kindref="member">advertising_adi</ref><sp/>&gt;&gt;<sp/>12;</highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>memcpy(list.Advertiser_Address,<sp/>link-&gt;<ref refid="structle__ext__scan__link_1a5e817b5ba0949889b86d1b13e0b36cb1" kindref="member">ext_adv_report</ref>.<ref refid="structle__ext__adv__report_1a5258855e162cee869cb31d363aae3aeb" kindref="member">address</ref>,<sp/>6);</highlight></codeline>
<codeline lineno="210"><highlight class="normal"></highlight></codeline>
<codeline lineno="211"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>log_info(&quot;Filter_Policy=0x%x&quot;,<sp/>sync-&gt;sync_param.Filter_Policy);<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="212"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>log_info(&quot;list=0x%x<sp/>0x%x&quot;,<sp/>list.Advertiser_Address_Type,<sp/>list.Advertising_SID);<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="213"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>log_info_hexdump(list.Advertiser_Address,<sp/>6);<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="214"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>log_info(&quot;param=0x%x<sp/>0x%x&quot;,<sp/>sync-&gt;sync_param.Advertising_Address_Type,<sp/>sync-&gt;sync_param.Advertising_SID);<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>log_info_hexdump(sync-&gt;sync_param.Advertiser_Address,<sp/>6);<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="216"><highlight class="normal"></highlight></codeline>
<codeline lineno="217"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">switch</highlight><highlight class="normal"><sp/>(sync-&gt;sync_param.Filter_Policy)<sp/>{</highlight></codeline>
<codeline lineno="218"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="ll__ext__scan_8h_1a24734c34558385990915f413953c6a12a9c851e958a51c43a9cb08c9cbd7515be" kindref="member">NOT_USE_PERIODIC_ADV_LIST</ref>:</highlight></codeline>
<codeline lineno="219"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>((list.Advertiser_Address_Type<sp/>==<sp/>sync-&gt;sync_param.Advertising_Address_Type)<sp/>&amp;&amp;<sp/>\</highlight></codeline>
<codeline lineno="220"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(list.Advertising_SID<sp/>==<sp/>sync-&gt;sync_param.Advertising_SID))<sp/>{</highlight></codeline>
<codeline lineno="221"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!memcmp(list.Advertiser_Address,<sp/>sync-&gt;sync_param.Advertiser_Address,<sp/>6))<sp/>{</highlight></codeline>
<codeline lineno="222"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="periodic__advertising_8h_1a89142a8970ae5b4af3c3c23ed18d7b25" kindref="member">ll_periodic_sync_open</ref>(link,<sp/>&amp;sync_info);</highlight></codeline>
<codeline lineno="223"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="224"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="225"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="226"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="227"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="ll__ext__scan_8h_1a24734c34558385990915f413953c6a12a1858dc01ce82cad717613bc361102200" kindref="member">USE_PERIODIC_ADV_LIST</ref>:</highlight></codeline>
<codeline lineno="228"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>log_info(&quot;USE_PERIODIC_ADV_LIST&quot;);<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(u8<sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>MAX_PERIODIC_ADVERTISER_LIST_NUMS;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="230"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!memcmp(&amp;list,<sp/>&amp;sync-&gt;list[i],<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(list)))<sp/>{</highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="periodic__advertising_8h_1a89142a8970ae5b4af3c3c23ed18d7b25" kindref="member">ll_periodic_sync_open</ref>(link,<sp/>&amp;sync_info);</highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="234"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="235"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="236"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="237"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="238"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>BLE5_FRAME_DEBUG</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="239"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">extern</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>__bb_le_sync_close(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/>ble_hw<sp/>*<sp/>hw);</highlight></codeline>
<codeline lineno="240"><highlight class="normal"></highlight></codeline>
<codeline lineno="241"><highlight class="normal"><sp/><sp/><sp/><sp/>__bb_le_sync_close(link-&gt;<ref refid="structle__ext__scan__link_1ad7fb35738ce774536efaaaec6e7e15d2" kindref="member">hw</ref>);</highlight></codeline>
<codeline lineno="242"><highlight class="normal"></highlight><highlight class="preprocessor">#else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="243"><highlight class="normal"><sp/><sp/><sp/><sp/>__ble5_ops-&gt;ext_ioctrl(link-&gt;<ref refid="structle__ext__scan__link_1ad7fb35738ce774536efaaaec6e7e15d2" kindref="member">hw</ref>,<sp/>BLE_SET_EXT_EXIT_SCAN_SYNC);</highlight></codeline>
<codeline lineno="244"><highlight class="normal"></highlight><highlight class="preprocessor">#endif<sp/></highlight><highlight class="comment">/*<sp/>BLE5_FRAME_DEBUG<sp/>*/</highlight><highlight class="preprocessor"></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="245"><highlight class="normal">}</highlight></codeline>
<codeline lineno="246"><highlight class="normal"></highlight></codeline>
<codeline lineno="247"><highlight class="normal"><ref refid="ll__ext__scan_8c_1a163fc974f6617f7f5c44dec8f5390964" kindref="member">AT_BLE5_LL_CODE</ref></highlight></codeline>
<codeline lineno="248"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>ll_ext_scan_rx_post(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*priv,<sp/></highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/>ble_ext_rx<sp/>*rx)</highlight></codeline>
<codeline lineno="249"><highlight class="normal">{</highlight></codeline>
<codeline lineno="250"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structle__ext__scan__link" kindref="compound">le_ext_scan_link</ref><sp/>*link<sp/>=<sp/>(</highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structle__ext__scan__link" kindref="compound">le_ext_scan_link</ref><sp/>*)priv;</highlight></codeline>
<codeline lineno="251"><highlight class="normal"></highlight></codeline>
<codeline lineno="252"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">switch</highlight><highlight class="normal"><sp/>(link-&gt;<ref refid="structle__ext__scan__link_1ade0e603045828a52ca79cf4915c9ca2f" kindref="member">state</ref>)<sp/>{</highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="extended__advertising_8h_1a61dadd085c1777f559549e05962b2c9ea71dd39fbc696cd765df7447926f9da38" kindref="member">LL_EXT_SCANNING</ref>:</highlight></codeline>
<codeline lineno="254"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>le_ext_adv_report_event_handle(link,<sp/>rx);</highlight></codeline>
<codeline lineno="255"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="256"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="extended__advertising_8h_1a61dadd085c1777f559549e05962b2c9eaeea0c02ac90ae394de6a3b726c561597" kindref="member">LL_EXT_SCANNING_SYNC_CREATE</ref>:</highlight></codeline>
<codeline lineno="257"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="extended__advertising_8h_1a61dadd085c1777f559549e05962b2c9eac33f62769d9ad92187c740ee9724f84a" kindref="member">LL_EXT_SCANNING_SYNC_ESTABLISHED</ref>:</highlight></codeline>
<codeline lineno="258"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="periodic__advertising_8h_1ae4c1173b1ac6bea157840c6ac6b761bb" kindref="member">le_periodic_adv_report_event_handle</ref>(link,<sp/>rx);</highlight></codeline>
<codeline lineno="259"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="260"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">default</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="261"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="262"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="263"><highlight class="normal">}</highlight></codeline>
<codeline lineno="264"><highlight class="normal"></highlight></codeline>
<codeline lineno="265"><highlight class="normal"><ref refid="ll__ext__scan_8c_1a163fc974f6617f7f5c44dec8f5390964" kindref="member">AT_BLE5_LL_CODE</ref></highlight></codeline>
<codeline lineno="266"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structle__ext__scan__link" kindref="compound">le_ext_scan_link</ref><sp/>*ll_create_ext_scan_link(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="267"><highlight class="normal">{</highlight></codeline>
<codeline lineno="268"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structle__ext__scan__link" kindref="compound">le_ext_scan_link</ref><sp/>*link;</highlight></codeline>
<codeline lineno="269"><highlight class="normal"></highlight></codeline>
<codeline lineno="270"><highlight class="normal"><sp/><sp/><sp/><sp/>link<sp/>=<sp/>(</highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structle__ext__scan__link" kindref="compound">le_ext_scan_link</ref><sp/>*)<ref refid="extended__advertising_8h_1a7cbafb36b7563c43bb77255c47dfd5fd" kindref="member">__new_ext_link</ref>(</highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(*link));</highlight></codeline>
<codeline lineno="271"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(NULL<sp/>==<sp/>link)<sp/>{</highlight></codeline>
<codeline lineno="272"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="273"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="274"><highlight class="normal"></highlight></codeline>
<codeline lineno="275"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>BLE5_FRAME_DEBUG</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="276"><highlight class="normal"><sp/><sp/><sp/><sp/>link-&gt;<ref refid="structle__ext__scan__link_1ad7fb35738ce774536efaaaec6e7e15d2" kindref="member">hw</ref><sp/>=<sp/>__ble5_ops-&gt;ext_open(EXT_AUX_SCAN_PARAM);</highlight></codeline>
<codeline lineno="277"><highlight class="normal"></highlight><highlight class="preprocessor">#else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="278"><highlight class="normal"><sp/><sp/><sp/><sp/>link-&gt;<ref refid="structle__ext__scan__link_1ad7fb35738ce774536efaaaec6e7e15d2" kindref="member">hw</ref><sp/>=<sp/>__ble5_ops-&gt;ext_open();</highlight></codeline>
<codeline lineno="279"><highlight class="normal"></highlight><highlight class="preprocessor">#endif<sp/></highlight><highlight class="comment">/*<sp/><sp/>*/</highlight><highlight class="preprocessor"></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="280"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(NULL<sp/>==<sp/>link-&gt;<ref refid="structle__ext__scan__link_1ad7fb35738ce774536efaaaec6e7e15d2" kindref="member">hw</ref>)<sp/>{</highlight></codeline>
<codeline lineno="281"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>__bt_free(link);</highlight></codeline>
<codeline lineno="282"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="283"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="284"><highlight class="normal"></highlight></codeline>
<codeline lineno="285"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>link;</highlight></codeline>
<codeline lineno="286"><highlight class="normal">}</highlight></codeline>
<codeline lineno="287"><highlight class="normal"></highlight></codeline>
<codeline lineno="288"><highlight class="normal"><ref refid="ll__ext__scan_8c_1a163fc974f6617f7f5c44dec8f5390964" kindref="member">AT_BLE5_LL_CODE</ref></highlight></codeline>
<codeline lineno="289"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structle__ext__scan__link" kindref="compound">le_ext_scan_link</ref><sp/>*ll_create_ext_secondary_scan(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="290"><highlight class="normal">{</highlight></codeline>
<codeline lineno="291"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structle__ext__scan__link" kindref="compound">le_ext_scan_link</ref><sp/>*ext_scan_link<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="292"><highlight class="normal"></highlight></codeline>
<codeline lineno="293"><highlight class="normal"><sp/><sp/><sp/><sp/>ext_scan_link<sp/>=<sp/>ll_create_ext_scan_link();</highlight></codeline>
<codeline lineno="294"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(NULL<sp/>==<sp/>ext_scan_link)<sp/>{</highlight></codeline>
<codeline lineno="295"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>log_error(</highlight><highlight class="stringliteral">&quot;ext<sp/>scan<sp/>secondary<sp/>create<sp/>error&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="296"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="297"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="298"><highlight class="normal"></highlight></codeline>
<codeline lineno="299"><highlight class="normal"><sp/><sp/><sp/><sp/>__ext_this-&gt;ext_scan_link<sp/>=<sp/>ext_scan_link;</highlight></codeline>
<codeline lineno="300"><highlight class="normal"></highlight></codeline>
<codeline lineno="301"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>BLE5_FRAME_DEBUG</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="302"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">extern</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>__bb_ext_reg_aux_scan_handler(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*<ref refid="structle__ext__scan__link_1ad7fb35738ce774536efaaaec6e7e15d2" kindref="member">hw</ref>,<sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*priv,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/>ble_ext_handler<sp/>*<sp/>handler);</highlight></codeline>
<codeline lineno="303"><highlight class="normal"></highlight></codeline>
<codeline lineno="304"><highlight class="normal"><sp/><sp/><sp/><sp/>__bb_ext_reg_aux_scan_handler(ext_scan_link-&gt;<ref refid="structle__ext__scan__link_1ad7fb35738ce774536efaaaec6e7e15d2" kindref="member">hw</ref>,<sp/>ext_scan_link,<sp/>&amp;ll_ext_scan_handler);</highlight></codeline>
<codeline lineno="305"><highlight class="normal"></highlight><highlight class="preprocessor">#else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="306"><highlight class="normal"><sp/><sp/><sp/><sp/>__ble5_ops-&gt;ext_handler_register(ext_scan_link-&gt;<ref refid="structle__ext__scan__link_1ad7fb35738ce774536efaaaec6e7e15d2" kindref="member">hw</ref>,<sp/>ext_scan_link,<sp/>&amp;ll_ext_scan_handler);</highlight></codeline>
<codeline lineno="307"><highlight class="normal"></highlight><highlight class="preprocessor">#endif<sp/></highlight><highlight class="comment">/*<sp/>BLE5_FRAME_DEBUG<sp/>*/</highlight><highlight class="preprocessor"></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="308"><highlight class="normal"></highlight></codeline>
<codeline lineno="309"><highlight class="normal"><sp/><sp/><sp/><sp/>ext_scan_link-&gt;<ref refid="structle__ext__scan__link_1a1f599a5a3aefab84126e1a5e350ca656" kindref="member">extended_scan</ref>.ext_scan<sp/>=<sp/><ref refid="hci__ll__cmds_8c_1ae306cbc8d57487606be6ee2a0740747f" kindref="member">ext_le_param</ref>.<ref refid="structext__le__parameter_1a062d8a9b1f0d0758a92c305367fce9cf" kindref="member">ext_scan</ref>;</highlight></codeline>
<codeline lineno="310"><highlight class="normal"></highlight></codeline>
<codeline lineno="311"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>ext_scan_link;</highlight></codeline>
<codeline lineno="312"><highlight class="normal">}</highlight></codeline>
<codeline lineno="313"><highlight class="normal"></highlight></codeline>
<codeline lineno="314"><highlight class="normal"><ref refid="ll__ext__scan_8c_1a163fc974f6617f7f5c44dec8f5390964" kindref="member">AT_BLE5_LL_CODE</ref></highlight></codeline>
<codeline lineno="315"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ll_create_ext_primary_scan(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structle__ext__scan__link" kindref="compound">le_ext_scan_link</ref><sp/>*link)</highlight></codeline>
<codeline lineno="316"><highlight class="normal">{</highlight></codeline>
<codeline lineno="317"><highlight class="normal"><sp/><sp/><sp/><sp/>link-&gt;<ref refid="structle__ext__scan__link_1a8ae19b5c0deba0c2e240a28887215b1f" kindref="member">primary_legacy_hw</ref><sp/>=<sp/>__ble_ops-&gt;open();</highlight></codeline>
<codeline lineno="318"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(NULL<sp/>==<sp/>link-&gt;<ref refid="structle__ext__scan__link_1a8ae19b5c0deba0c2e240a28887215b1f" kindref="member">primary_legacy_hw</ref>)<sp/>{</highlight></codeline>
<codeline lineno="319"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>log_error(</highlight><highlight class="stringliteral">&quot;ext<sp/>scan<sp/>primary<sp/>create<sp/>error&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="320"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>MEMORY_CAPACITY_EXCEEDED;</highlight></codeline>
<codeline lineno="321"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="322"><highlight class="normal"></highlight></codeline>
<codeline lineno="323"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>BLE5_FRAME_DEBUG</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="324"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">extern</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>__bb_le_alloc_ext_scan_param(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*<ref refid="structle__ext__scan__link_1ad7fb35738ce774536efaaaec6e7e15d2" kindref="member">hw</ref>);</highlight></codeline>
<codeline lineno="325"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">extern</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>__bb_le_link_to_ext_scan_hw(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*<ref refid="structle__ext__scan__link_1ad7fb35738ce774536efaaaec6e7e15d2" kindref="member">hw</ref>,<sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*primary_hw);</highlight></codeline>
<codeline lineno="326"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">extern</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>__bb_le_link_to_aux_scan_hw(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*<ref refid="structle__ext__scan__link_1ad7fb35738ce774536efaaaec6e7e15d2" kindref="member">hw</ref>,<sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*secondary_hw);</highlight></codeline>
<codeline lineno="327"><highlight class="normal"></highlight></codeline>
<codeline lineno="328"><highlight class="normal"><sp/><sp/><sp/><sp/>__bb_le_alloc_ext_scan_param(link-&gt;<ref refid="structle__ext__scan__link_1a8ae19b5c0deba0c2e240a28887215b1f" kindref="member">primary_legacy_hw</ref>);</highlight></codeline>
<codeline lineno="329"><highlight class="normal"></highlight></codeline>
<codeline lineno="330"><highlight class="normal"><sp/><sp/><sp/><sp/>__bb_le_link_to_ext_scan_hw(link-&gt;<ref refid="structle__ext__scan__link_1ad7fb35738ce774536efaaaec6e7e15d2" kindref="member">hw</ref>,<sp/>link-&gt;<ref refid="structle__ext__scan__link_1a8ae19b5c0deba0c2e240a28887215b1f" kindref="member">primary_legacy_hw</ref>);</highlight></codeline>
<codeline lineno="331"><highlight class="normal"></highlight></codeline>
<codeline lineno="332"><highlight class="normal"><sp/><sp/><sp/><sp/>__bb_le_link_to_aux_scan_hw(link-&gt;<ref refid="structle__ext__scan__link_1a8ae19b5c0deba0c2e240a28887215b1f" kindref="member">primary_legacy_hw</ref>,<sp/>link-&gt;<ref refid="structle__ext__scan__link_1ad7fb35738ce774536efaaaec6e7e15d2" kindref="member">hw</ref>);</highlight></codeline>
<codeline lineno="333"><highlight class="normal"></highlight></codeline>
<codeline lineno="334"><highlight class="normal"></highlight><highlight class="preprocessor">#else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="335"><highlight class="normal"><sp/><sp/><sp/><sp/>__ble5_ops-&gt;ext_adv_ctrl(link-&gt;<ref refid="structle__ext__scan__link_1ad7fb35738ce774536efaaaec6e7e15d2" kindref="member">hw</ref>,<sp/>BLE_SET_EXT_CORRELATED_HW,<sp/>link-&gt;<ref refid="structle__ext__scan__link_1a8ae19b5c0deba0c2e240a28887215b1f" kindref="member">primary_legacy_hw</ref>);</highlight></codeline>
<codeline lineno="336"><highlight class="normal"></highlight></codeline>
<codeline lineno="337"><highlight class="normal"><sp/><sp/><sp/><sp/>__ble5_ops-&gt;ext_adv_ctrl(link-&gt;<ref refid="structle__ext__scan__link_1a8ae19b5c0deba0c2e240a28887215b1f" kindref="member">primary_legacy_hw</ref>,<sp/>BLE_SET_EXT_CORRELATED_HW,<sp/>link-&gt;<ref refid="structle__ext__scan__link_1ad7fb35738ce774536efaaaec6e7e15d2" kindref="member">hw</ref>);</highlight></codeline>
<codeline lineno="338"><highlight class="normal"></highlight><highlight class="preprocessor">#endif<sp/></highlight><highlight class="comment">/*<sp/>BLE5_FRAME_DEBUG<sp/>*/</highlight><highlight class="preprocessor"></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="339"><highlight class="normal"></highlight></codeline>
<codeline lineno="340"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>SUCCESS;</highlight></codeline>
<codeline lineno="341"><highlight class="normal">}</highlight></codeline>
<codeline lineno="342"><highlight class="normal"></highlight></codeline>
<codeline lineno="343"><highlight class="normal"><ref refid="ll__ext__scan_8c_1a163fc974f6617f7f5c44dec8f5390964" kindref="member">AT_BLE5_LL_CODE</ref></highlight></codeline>
<codeline lineno="344"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>__set_ll_ext_scan_state(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structle__ext__scan__link" kindref="compound">le_ext_scan_link</ref><sp/>*link)</highlight></codeline>
<codeline lineno="345"><highlight class="normal">{</highlight></codeline>
<codeline lineno="346"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">ble_ext_scan<sp/>*scan<sp/>=<sp/>&amp;link-&gt;<ref refid="structle__ext__scan__link_1a1f599a5a3aefab84126e1a5e350ca656" kindref="member">extended_scan</ref>;</highlight></codeline>
<codeline lineno="347"><highlight class="normal"></highlight></codeline>
<codeline lineno="348"><highlight class="normal"><sp/><sp/><sp/><sp/>log_info(</highlight><highlight class="stringliteral">&quot;--func=%s&quot;</highlight><highlight class="normal">,<sp/>__FUNCTION__);</highlight></codeline>
<codeline lineno="349"><highlight class="normal"></highlight></codeline>
<codeline lineno="350"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="link__layer_8c_1adfe227fcb9e3cd5517eb4074f28168fe" kindref="member">__set_ll_local_addr</ref>(link-&gt;<ref refid="structle__ext__scan__link_1a8ae19b5c0deba0c2e240a28887215b1f" kindref="member">primary_legacy_hw</ref>,<sp/>\</highlight></codeline>
<codeline lineno="351"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;scan-&gt;addr,<sp/>\</highlight></codeline>
<codeline lineno="352"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>scan-&gt;ext_scan-&gt;ext_scan_param.Own_Address_Type);</highlight></codeline>
<codeline lineno="353"><highlight class="normal"></highlight></codeline>
<codeline lineno="354"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="extended__advertising_8h_1a7676b55f4bcfbbbb802bbcd723b241fa" kindref="member">__set_ll_ext_local_addr</ref>(link-&gt;<ref refid="structle__ext__scan__link_1ad7fb35738ce774536efaaaec6e7e15d2" kindref="member">hw</ref>,<sp/>\</highlight></codeline>
<codeline lineno="355"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;scan-&gt;addr,<sp/>\</highlight></codeline>
<codeline lineno="356"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>scan-&gt;ext_scan-&gt;ext_scan_param.Own_Address_Type);</highlight></codeline>
<codeline lineno="357"><highlight class="normal"></highlight></codeline>
<codeline lineno="358"><highlight class="normal"><sp/><sp/><sp/><sp/>scan-&gt;coded_s<sp/>=<sp/>LE_DEFAULT_CODED_S;</highlight></codeline>
<codeline lineno="359"><highlight class="normal"></highlight></codeline>
<codeline lineno="360"><highlight class="normal"><sp/><sp/><sp/><sp/>link-&gt;<ref refid="structle__ext__scan__link_1ade0e603045828a52ca79cf4915c9ca2f" kindref="member">state</ref><sp/>=<sp/><ref refid="extended__advertising_8h_1a61dadd085c1777f559549e05962b2c9ea71dd39fbc696cd765df7447926f9da38" kindref="member">LL_EXT_SCANNING</ref>;</highlight></codeline>
<codeline lineno="361"><highlight class="normal"></highlight></codeline>
<codeline lineno="362"><highlight class="normal"><sp/><sp/><sp/><sp/>__ble5_ops-&gt;ext_scanning(link-&gt;<ref refid="structle__ext__scan__link_1ad7fb35738ce774536efaaaec6e7e15d2" kindref="member">hw</ref>,<sp/>link-&gt;<ref refid="structle__ext__scan__link_1a8ae19b5c0deba0c2e240a28887215b1f" kindref="member">primary_legacy_hw</ref>,<sp/>scan);</highlight></codeline>
<codeline lineno="363"><highlight class="normal">}</highlight></codeline>
<codeline lineno="364"><highlight class="normal"></highlight></codeline>
<codeline lineno="365"><highlight class="normal"><ref refid="ll__ext__scan_8c_1a163fc974f6617f7f5c44dec8f5390964" kindref="member">AT_BLE5_LL_CODE</ref></highlight></codeline>
<codeline lineno="366"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>ll_ext_scan_timeout_stop(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="367"><highlight class="normal">{</highlight></codeline>
<codeline lineno="368"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(__ext_this-&gt;ext_scan_timer)<sp/>{</highlight></codeline>
<codeline lineno="369"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>sys_timer_remove(__ext_this-&gt;ext_scan_timer);</highlight></codeline>
<codeline lineno="370"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>__ext_this-&gt;ext_scan_timer<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="371"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="372"><highlight class="normal">}</highlight></codeline>
<codeline lineno="373"><highlight class="normal"></highlight></codeline>
<codeline lineno="374"><highlight class="normal"><ref refid="ll__ext__scan_8c_1a163fc974f6617f7f5c44dec8f5390964" kindref="member">AT_BLE5_LL_CODE</ref></highlight></codeline>
<codeline lineno="375"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>ll_ext_scan_timer_handler(sys_timer<sp/>*<ref refid="llcp__sm__pc_8c_1a2f0cdb43f1c9024afabfab4d9ee48f5e" kindref="member">timer</ref>)</highlight></codeline>
<codeline lineno="376"><highlight class="normal">{</highlight></codeline>
<codeline lineno="377"><highlight class="normal"><sp/><sp/><sp/><sp/>log_error(</highlight><highlight class="stringliteral">&quot;TO<sp/>-<sp/>ll_ext_scan_timer_handler&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="378"><highlight class="normal"></highlight></codeline>
<codeline lineno="379"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>OS_ENTER_CRITICAL();<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="380"><highlight class="normal"></highlight></codeline>
<codeline lineno="381"><highlight class="normal"><sp/><sp/><sp/><sp/>ll_ext_scan_timeout_stop();</highlight></codeline>
<codeline lineno="382"><highlight class="normal"></highlight></codeline>
<codeline lineno="383"><highlight class="normal"><sp/><sp/><sp/><sp/>le_scan_timeout_event();</highlight></codeline>
<codeline lineno="384"><highlight class="normal"></highlight></codeline>
<codeline lineno="385"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(__ext_this-&gt;ext_scan_link)<sp/>{</highlight></codeline>
<codeline lineno="386"><highlight class="normal"></highlight></codeline>
<codeline lineno="387"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>__ext_this-&gt;ext_scan_link-&gt;state<sp/>=<sp/><ref refid="extended__advertising_8h_1a61dadd085c1777f559549e05962b2c9ea3ce9a770dbef2ccc3356162f390bbd25" kindref="member">LL_EXT_SCANNING_DURATION_END</ref>;</highlight></codeline>
<codeline lineno="388"><highlight class="normal"></highlight></codeline>
<codeline lineno="389"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="link__layer_8c_1af5e4ac77575bf70aae9293b0c2925f61" kindref="member">ll_thread_resume</ref>();</highlight></codeline>
<codeline lineno="390"><highlight class="normal"></highlight></codeline>
<codeline lineno="391"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{<sp/></highlight><highlight class="comment">//<sp/>next<sp/>duration</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="392"><highlight class="normal"></highlight></codeline>
<codeline lineno="393"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="ll__ext__scan_8h_1af4bfb24266d7b367c6661bf6265e1691" kindref="member">ll_ext_scan_open</ref>();</highlight></codeline>
<codeline lineno="394"><highlight class="normal"></highlight></codeline>
<codeline lineno="395"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="396"><highlight class="normal"></highlight></codeline>
<codeline lineno="397"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>OS_EXIT_CRITICAL();<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="398"><highlight class="normal">}</highlight></codeline>
<codeline lineno="399"><highlight class="normal"></highlight></codeline>
<codeline lineno="400"><highlight class="normal"><ref refid="ll__ext__scan_8c_1a163fc974f6617f7f5c44dec8f5390964" kindref="member">AT_BLE5_LL_CODE</ref></highlight></codeline>
<codeline lineno="401"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ll_ext_scan_timeout_start(u32<sp/>timeout)</highlight></codeline>
<codeline lineno="402"><highlight class="normal">{</highlight></codeline>
<codeline lineno="403"><highlight class="normal"><sp/><sp/><sp/><sp/>log_info(</highlight><highlight class="stringliteral">&quot;ext<sp/>scan<sp/>timeout<sp/>:<sp/>%dms&quot;</highlight><highlight class="normal">,<sp/>timeout);</highlight></codeline>
<codeline lineno="404"><highlight class="normal"></highlight></codeline>
<codeline lineno="405"><highlight class="normal"><sp/><sp/><sp/><sp/>__ext_this-&gt;ext_scan_timer<sp/>=<sp/>sys_timer_register(timeout,<sp/>ll_ext_scan_timer_handler);</highlight></codeline>
<codeline lineno="406"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(0<sp/>==<sp/>__ext_this-&gt;ext_scan_timer)<sp/>{</highlight></codeline>
<codeline lineno="407"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>log_error(</highlight><highlight class="stringliteral">&quot;create<sp/>ext_scan<sp/>timer<sp/>fail&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="408"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="ll__ext__scan_8h_1ade4085d263f6f451ccd74a02e2f9f561" kindref="member">ll_ext_scan_close</ref>();</highlight></codeline>
<codeline lineno="409"><highlight class="normal"></highlight></codeline>
<codeline lineno="410"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>MEMORY_CAPACITY_EXCEEDED;</highlight></codeline>
<codeline lineno="411"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="412"><highlight class="normal"></highlight></codeline>
<codeline lineno="413"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>SUCCESS;</highlight></codeline>
<codeline lineno="414"><highlight class="normal">}</highlight></codeline>
<codeline lineno="415"><highlight class="normal"></highlight></codeline>
<codeline lineno="416"><highlight class="normal"><ref refid="ll__ext__scan_8c_1a163fc974f6617f7f5c44dec8f5390964" kindref="member">AT_BLE5_LL_CODE</ref></highlight></codeline>
<codeline lineno="417"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ll_ext_scan_create_duration_timer(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structle__ext__scan__link" kindref="compound">le_ext_scan_link</ref><sp/>*link)</highlight></codeline>
<codeline lineno="418"><highlight class="normal">{</highlight></codeline>
<codeline lineno="419"><highlight class="normal"><sp/><sp/><sp/><sp/>u32<sp/>duration_ms;</highlight></codeline>
<codeline lineno="420"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>status<sp/>=<sp/>SUCCESS;</highlight></codeline>
<codeline lineno="421"><highlight class="normal"></highlight></codeline>
<codeline lineno="422"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*</highlight></codeline>
<codeline lineno="423"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>If<sp/>the<sp/>Duration<sp/>parameter<sp/>is<sp/>zero<sp/>or<sp/>both<sp/>the<sp/>Duration<sp/>parameter<sp/>and<sp/>Period</highlight></codeline>
<codeline lineno="424"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>parameter<sp/>are<sp/>non-zero,<sp/>the<sp/>Controller<sp/>shall<sp/>continue<sp/>scanning<sp/>until<sp/>scanning</highlight></codeline>
<codeline lineno="425"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>is<sp/>disabled<sp/>by<sp/>the<sp/>Host<sp/>issuing<sp/>an<sp/>LE_Set_Extended_Scan_Enable<sp/>command</highlight></codeline>
<codeline lineno="426"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>with<sp/>the<sp/>Enable<sp/>parameter<sp/>set<sp/>to<sp/>0x00<sp/>(Scanning<sp/>is<sp/>disabled).<sp/>The<sp/>Period</highlight></codeline>
<codeline lineno="427"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>parameter<sp/>is<sp/>ignored<sp/>when<sp/>the<sp/>Duration<sp/>parameter<sp/>is<sp/>zero.</highlight></codeline>
<codeline lineno="428"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*</highlight></codeline>
<codeline lineno="429"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="430"><highlight class="normal"></highlight></codeline>
<codeline lineno="431"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//&lt;<sp/>get<sp/>duration,<sp/>duration<sp/>unit:10ms</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="432"><highlight class="normal"><sp/><sp/><sp/><sp/>duration_ms<sp/>=<sp/>link-&gt;<ref refid="structle__ext__scan__link_1a1f599a5a3aefab84126e1a5e350ca656" kindref="member">extended_scan</ref>.ext_scan-&gt;ext_scan_enable.Duration<sp/>*<sp/><ref refid="ll__ext__scan_8h_1a2b5c7ef5af92b367d121312c78628cdd" kindref="member">\</ref></highlight></codeline>
<codeline lineno="433"><highlight class="normal"><ref refid="ll__ext__scan_8h_1a2b5c7ef5af92b367d121312c78628cdd" kindref="member">                  EXT_SCAN_DURATION_UNIT_MS</ref>;</highlight></codeline>
<codeline lineno="434"><highlight class="normal"></highlight></codeline>
<codeline lineno="435"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(duration_ms)<sp/>{</highlight></codeline>
<codeline lineno="436"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>log_info(</highlight><highlight class="stringliteral">&quot;start<sp/>new<sp/>Scan<sp/>Duration&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="437"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>status<sp/>=<sp/>ll_ext_scan_timeout_start(duration_ms);</highlight></codeline>
<codeline lineno="438"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="439"><highlight class="normal"></highlight></codeline>
<codeline lineno="440"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>status;</highlight></codeline>
<codeline lineno="441"><highlight class="normal">}</highlight></codeline>
<codeline lineno="442"><highlight class="normal"></highlight></codeline>
<codeline lineno="443"><highlight class="normal"></highlight><highlight class="comment">/*-----------------------*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="444"><highlight class="normal"></highlight><highlight class="comment">/*</highlight></codeline>
<codeline lineno="445"><highlight class="comment"><sp/>*<sp/><sp/><sp/><sp/><sp/><sp/>LL<sp/>Internal<sp/>API</highlight></codeline>
<codeline lineno="446"><highlight class="comment"><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="447"><highlight class="normal"></highlight></codeline>
<codeline lineno="448"><highlight class="normal"><ref refid="ll__ext__scan_8c_1a163fc974f6617f7f5c44dec8f5390964" kindref="member">AT_BLE5_LL_CODE</ref></highlight></codeline>
<codeline lineno="449"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="ll__ext__scan_8h_1a221c4b601e98bc1d1ca824ebb153c862" kindref="member">build_ext_aux_adv_report</ref>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/><ref refid="structle__ext__scan__link" kindref="compound">le_ext_scan_link</ref><sp/>*link,<sp/></highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/>ble_ext_rx<sp/>*rx,<sp/>u8<sp/>*offset)</highlight></codeline>
<codeline lineno="450"><highlight class="normal">{</highlight></codeline>
<codeline lineno="451"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structle__ext__adv__report" kindref="compound">le_ext_adv_report</ref><sp/>*report<sp/>=<sp/>&amp;link-&gt;<ref refid="structle__ext__scan__link_1a5e817b5ba0949889b86d1b13e0b36cb1" kindref="member">ext_adv_report</ref>;</highlight></codeline>
<codeline lineno="452"><highlight class="normal"></highlight></codeline>
<codeline lineno="453"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(rx-&gt;data_status<sp/>&amp;<sp/>BIT(DATA_TRUNCATED))<sp/>{</highlight></codeline>
<codeline lineno="454"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="ll__ext__scan_8h_1a31edb8834d915e6d288298493ba1c6b7" kindref="member">SET_BIT</ref>(report-&gt;<ref refid="structle__ext__adv__report_1ae7c314a0b5f87a827f1bb13c8083e433" kindref="member">event_type</ref>,<sp/>5,<sp/>2,<sp/>DATA_TRUNCATED);</highlight></codeline>
<codeline lineno="455"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*offset<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="456"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>TRUE;</highlight></codeline>
<codeline lineno="457"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="458"><highlight class="normal"></highlight></codeline>
<codeline lineno="459"><highlight class="normal"><sp/><sp/><sp/><sp/>u8<sp/>ext_flag<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="460"><highlight class="normal"></highlight></codeline>
<codeline lineno="461"><highlight class="normal"><sp/><sp/><sp/><sp/>ext_adv_hdr_t<sp/>ext_adv_hdr<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="462"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.ext_hdr_len<sp/>=<sp/>rx-&gt;data[0]<sp/>&amp;<sp/>EXT_HEADER_LEN_MASK,</highlight></codeline>
<codeline lineno="463"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.advmode<sp/>=<sp/>(rx-&gt;data[0]<sp/>&gt;&gt;<sp/>6)<sp/>&amp;EXT_ADV_MODE_MASK,</highlight></codeline>
<codeline lineno="464"><highlight class="normal"><sp/><sp/><sp/><sp/>};</highlight></codeline>
<codeline lineno="465"><highlight class="normal"></highlight></codeline>
<codeline lineno="466"><highlight class="normal"><sp/><sp/><sp/><sp/>u8<sp/>ext_hdr_len<sp/>=<sp/><ref refid="ll__defines_8h_1a9fa287ceebff434e4c8b4d2803355bcd" kindref="member">LL_EXT_ADV_HDR_MIN_LEN</ref><sp/>+<sp/>ext_adv_hdr.ext_hdr_len;</highlight></codeline>
<codeline lineno="467"><highlight class="normal"></highlight></codeline>
<codeline lineno="468"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//&lt;<sp/>set<sp/>event_type</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="469"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(rx-&gt;data_status<sp/>&amp;<sp/>BIT(DATA_NEW_ROUND))<sp/>{</highlight></codeline>
<codeline lineno="470"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>memset(report,<sp/>0,<sp/>sizeof(*report));<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="471"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">switch</highlight><highlight class="normal"><sp/>(ext_adv_hdr.advmode)<sp/>{</highlight></codeline>
<codeline lineno="472"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>AM_NONCON_NONSCAN:</highlight></codeline>
<codeline lineno="473"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="474"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>AM_CON_NONSCAN:</highlight></codeline>
<codeline lineno="475"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>report-&gt;<ref refid="structle__ext__adv__report_1ae7c314a0b5f87a827f1bb13c8083e433" kindref="member">event_type</ref><sp/>=<sp/>BIT(<ref refid="ll__ext__scan_8h_1a8f5e0748087b87d63826c26de3e9ab94a0942121ad971374a0a42662db4e9ccdd" kindref="member">REPORT_CONNECTABLE_ADV</ref>);</highlight></codeline>
<codeline lineno="476"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="477"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>AM_NONCON_SCAN:</highlight></codeline>
<codeline lineno="478"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>report-&gt;<ref refid="structle__ext__adv__report_1ae7c314a0b5f87a827f1bb13c8083e433" kindref="member">event_type</ref><sp/>=<sp/>BIT(<ref refid="ll__ext__scan_8h_1a8f5e0748087b87d63826c26de3e9ab94a22e2f447fdae8ae5ed8084bec1c5f557" kindref="member">REPORT_SCANNABLE_ADV</ref>);</highlight></codeline>
<codeline lineno="479"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="480"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="481"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="482"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(rx-&gt;data_status<sp/>&amp;<sp/>BIT(DATA_SCAN_RSP))<sp/>{</highlight></codeline>
<codeline lineno="483"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>report-&gt;<ref refid="structle__ext__adv__report_1ae7c314a0b5f87a827f1bb13c8083e433" kindref="member">event_type</ref><sp/>|=<sp/>BIT(<ref refid="ll__ext__scan_8h_1a8f5e0748087b87d63826c26de3e9ab94ac2b98df6f424919de4036e3e0814020f" kindref="member">REPORT_SCAN_RSP</ref>);</highlight></codeline>
<codeline lineno="484"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="485"><highlight class="normal"></highlight></codeline>
<codeline lineno="486"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//&lt;<sp/>set<sp/>data_status</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="487"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(rx-&gt;data_status<sp/>&amp;<sp/>BIT(DATA_COMPLETE))<sp/>{</highlight></codeline>
<codeline lineno="488"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="ll__ext__scan_8h_1a31edb8834d915e6d288298493ba1c6b7" kindref="member">SET_BIT</ref>(report-&gt;<ref refid="structle__ext__adv__report_1ae7c314a0b5f87a827f1bb13c8083e433" kindref="member">event_type</ref>,<sp/>5,<sp/>2,<sp/>DATA_COMPLETE);</highlight></codeline>
<codeline lineno="489"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="490"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="ll__ext__scan_8h_1a31edb8834d915e6d288298493ba1c6b7" kindref="member">SET_BIT</ref>(report-&gt;<ref refid="structle__ext__adv__report_1ae7c314a0b5f87a827f1bb13c8083e433" kindref="member">event_type</ref>,<sp/>5,<sp/>2,<sp/>DATA_MORE_COME);</highlight></codeline>
<codeline lineno="491"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="492"><highlight class="normal"></highlight></codeline>
<codeline lineno="493"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//&lt;<sp/>reload<sp/>ext_header</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="494"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ext_adv_hdr.ext_hdr_len)<sp/>{</highlight></codeline>
<codeline lineno="495"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ext_flag<sp/>=<sp/>rx-&gt;data[1];</highlight></codeline>
<codeline lineno="496"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="ll__ext__scan_8h_1afa8428cfa3a9fb61b026d517abd908e4" kindref="member">MAKE_REPORT</ref>(FLAG_ADVA,<sp/>&amp;report-&gt;<ref refid="structle__ext__adv__report_1a5258855e162cee869cb31d363aae3aeb" kindref="member">address</ref>);</highlight></codeline>
<codeline lineno="497"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="ll__ext__scan_8h_1afa8428cfa3a9fb61b026d517abd908e4" kindref="member">MAKE_REPORT</ref>(FLAG_TXPOWER,<sp/>&amp;report-&gt;<ref refid="structle__ext__adv__report_1aa6eaae2ee50ad78f66efcc1b95f29daa" kindref="member">tx_power</ref>);</highlight></codeline>
<codeline lineno="498"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="ll__ext__scan_8h_1afa8428cfa3a9fb61b026d517abd908e4" kindref="member">MAKE_REPORT</ref>(FLAG_ADI,<sp/>&amp;report-&gt;<ref refid="structle__ext__adv__report_1a6a5e8bfd5dee48062ee3c1f919bd23bc" kindref="member">advertising_adi</ref>);</highlight></codeline>
<codeline lineno="499"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ext_flag<sp/>&amp;<sp/>FLAG_TARGETA)<sp/>{</highlight></codeline>
<codeline lineno="500"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="ll__ext__scan_8h_1afa8428cfa3a9fb61b026d517abd908e4" kindref="member">MAKE_REPORT</ref>(FLAG_TARGETA,<sp/>&amp;report-&gt;<ref refid="structle__ext__adv__report_1ad0be59bf450c185a6b76136fc698add9" kindref="member">direct_address</ref>);</highlight></codeline>
<codeline lineno="501"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//&lt;<sp/>aviod<sp/>invalid<sp/>TargetA</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="502"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(memcmp(&amp;report-&gt;<ref refid="structle__ext__adv__report_1ad0be59bf450c185a6b76136fc698add9" kindref="member">direct_address</ref>,<sp/>link-&gt;<ref refid="structle__ext__scan__link_1a1f599a5a3aefab84126e1a5e350ca656" kindref="member">extended_scan</ref>.addr.addr,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(report-&gt;<ref refid="structle__ext__adv__report_1ad0be59bf450c185a6b76136fc698add9" kindref="member">direct_address</ref>)))<sp/>{</highlight></codeline>
<codeline lineno="503"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="504"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="505"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>report-&gt;<ref refid="structle__ext__adv__report_1ae7c314a0b5f87a827f1bb13c8083e433" kindref="member">event_type</ref><sp/>|=<sp/>BIT(<ref refid="ll__ext__scan_8h_1a8f5e0748087b87d63826c26de3e9ab94aeebedd486df2e1f5a4a2202dbd14a816" kindref="member">REPORT_DIRECTED_ADV</ref>);</highlight></codeline>
<codeline lineno="506"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="507"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>BLUETOOTH_5P1</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="508"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ext_flag<sp/>&amp;<sp/>FLAG_CTEINFO)<sp/>{</highlight></codeline>
<codeline lineno="509"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="ll__ext__scan_8h_1afa8428cfa3a9fb61b026d517abd908e4" kindref="member">MAKE_REPORT</ref>(FLAG_CTEINFO,<sp/>&amp;report-&gt;<ref refid="structle__ext__adv__report_1ae2b5ba6ee38e03f19e7cdf4a467a4179" kindref="member">cte_type</ref>);</highlight></codeline>
<codeline lineno="510"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>report-&gt;<ref refid="structle__ext__adv__report_1ae2b5ba6ee38e03f19e7cdf4a467a4179" kindref="member">cte_type</ref><sp/>&amp;=<sp/>0x03;</highlight></codeline>
<codeline lineno="511"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="512"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>report-&gt;<ref refid="structle__ext__adv__report_1ae2b5ba6ee38e03f19e7cdf4a467a4179" kindref="member">cte_type</ref><sp/>=<sp/>0xff;</highlight></codeline>
<codeline lineno="513"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="514"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="515"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="516"><highlight class="normal"><sp/><sp/><sp/><sp/>*offset<sp/>=<sp/>ext_hdr_len;<sp/></highlight><highlight class="comment">//<sp/>adv<sp/>data<sp/>length</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="517"><highlight class="normal"></highlight></codeline>
<codeline lineno="518"><highlight class="normal"></highlight></codeline>
<codeline lineno="519"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>TRUE;</highlight></codeline>
<codeline lineno="520"><highlight class="normal">}</highlight></codeline>
<codeline lineno="521"><highlight class="normal"></highlight></codeline>
<codeline lineno="522"><highlight class="normal"><ref refid="ll__ext__scan_8c_1a163fc974f6617f7f5c44dec8f5390964" kindref="member">AT_BLE5_LL_CODE</ref></highlight></codeline>
<codeline lineno="523"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>ll_ext_scan_duration_end(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="524"><highlight class="normal">{</highlight></codeline>
<codeline lineno="525"><highlight class="normal"><sp/><sp/><sp/><sp/>u32<sp/>duration,<sp/>period;</highlight></codeline>
<codeline lineno="526"><highlight class="normal"></highlight></codeline>
<codeline lineno="527"><highlight class="normal"><sp/><sp/><sp/><sp/>duration<sp/>=<sp/>__ext_this-&gt;ext_scan_link-&gt;extended_scan.ext_scan-&gt;ext_scan_enable.Duration;</highlight></codeline>
<codeline lineno="528"><highlight class="normal"><sp/><sp/><sp/><sp/>period<sp/>=<sp/>__ext_this-&gt;ext_scan_link-&gt;extended_scan.ext_scan-&gt;ext_scan_enable.Period;</highlight></codeline>
<codeline lineno="529"><highlight class="normal"></highlight></codeline>
<codeline lineno="530"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*</highlight></codeline>
<codeline lineno="531"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>If<sp/>the<sp/>Duration<sp/>parameter<sp/>is<sp/>non-zero<sp/>and<sp/>the<sp/>Period<sp/>parameter<sp/>is<sp/>zero,<sp/>the</highlight></codeline>
<codeline lineno="532"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>Controller<sp/>shall<sp/>continue<sp/>scanning<sp/>until<sp/>the<sp/>duration<sp/>specified<sp/>in<sp/>the<sp/>Duration</highlight></codeline>
<codeline lineno="533"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>parameter<sp/>has<sp/>expired.</highlight></codeline>
<codeline lineno="534"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="535"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(period)<sp/>{</highlight></codeline>
<codeline lineno="536"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="ll__ext__scan_8h_1ade4085d263f6f451ccd74a02e2f9f561" kindref="member">ll_ext_scan_close</ref>();</highlight></codeline>
<codeline lineno="537"><highlight class="normal"></highlight></codeline>
<codeline lineno="538"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//&lt;<sp/>duration<sp/>unit:10ms,<sp/>period<sp/>unit:1.28s</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="539"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>log_info(</highlight><highlight class="stringliteral">&quot;start<sp/>new<sp/>Scan<sp/>Period&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="540"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ll_ext_scan_timeout_start((period<sp/>*<sp/><ref refid="ll__ext__scan_8h_1a028a8ab6611a0cdec1bcbf8a675d72dc" kindref="member">EXT_SCAN_PERIOD_UNIT_MS</ref>)<sp/>-<sp/>\</highlight></codeline>
<codeline lineno="541"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(duration<sp/>*<sp/><ref refid="ll__ext__scan_8h_1a2b5c7ef5af92b367d121312c78628cdd" kindref="member">EXT_SCAN_DURATION_UNIT_MS</ref>));</highlight></codeline>
<codeline lineno="542"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="543"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="ll__ext__scan_8h_1a20e06cdf14a775b8b694fe278c00b1aa" kindref="member">destroy_le_ext_scan</ref>();</highlight></codeline>
<codeline lineno="544"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="545"><highlight class="normal">}</highlight></codeline>
<codeline lineno="546"><highlight class="normal"></highlight></codeline>
<codeline lineno="547"><highlight class="normal"><ref refid="ll__ext__scan_8c_1a163fc974f6617f7f5c44dec8f5390964" kindref="member">AT_BLE5_LL_CODE</ref></highlight></codeline>
<codeline lineno="548"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="ll__ext__scan_8h_1a6b20604feb2c552a003e02022e7132cd" kindref="member">ll_ext_scan_rx_post_process</ref>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>*empty)</highlight></codeline>
<codeline lineno="549"><highlight class="normal">{</highlight></codeline>
<codeline lineno="550"><highlight class="normal"><sp/><sp/><sp/><sp/>LE_ROLES_IS_SUPPORT_OPTIMIZE(LE_MASTER);</highlight></codeline>
<codeline lineno="551"><highlight class="normal"></highlight></codeline>
<codeline lineno="552"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(__ext_this-&gt;ext_scan_link)<sp/>{</highlight></codeline>
<codeline lineno="553"><highlight class="normal"></highlight></codeline>
<codeline lineno="554"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="extended__advertising_8h_1a61dadd085c1777f559549e05962b2c9ea3ce9a770dbef2ccc3356162f390bbd25" kindref="member">LL_EXT_SCANNING_DURATION_END</ref><sp/>==<sp/>__ext_this-&gt;ext_scan_link-&gt;state)<sp/>{</highlight></codeline>
<codeline lineno="555"><highlight class="normal"></highlight></codeline>
<codeline lineno="556"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ll_ext_scan_duration_end();</highlight></codeline>
<codeline lineno="557"><highlight class="normal"></highlight></codeline>
<codeline lineno="558"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="559"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="560"><highlight class="normal"></highlight></codeline>
<codeline lineno="561"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="periodic__advertising_8h_1af49afe5c179976ba5bdfcae51ef44c1b" kindref="member">le_periodic_sync_timeout_close</ref>(__ext_this-&gt;ext_scan_link);</highlight></codeline>
<codeline lineno="562"><highlight class="normal"></highlight></codeline>
<codeline lineno="563"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>BLE5_FRAME_DEBUG</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="564"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">extern</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>__bb_le_upload_aux_scan_rx_data(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*hw,<sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>(*rx_handler)(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*priv,<sp/></highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/>ble_ext_rx<sp/>*<sp/>rx));</highlight></codeline>
<codeline lineno="565"><highlight class="normal"></highlight></codeline>
<codeline lineno="566"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>__bb_le_upload_aux_scan_rx_data(__ext_this-&gt;ext_scan_link-&gt;hw,<sp/>ll_ext_scan_rx_post);</highlight></codeline>
<codeline lineno="567"><highlight class="normal"></highlight><highlight class="preprocessor">#else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="568"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>__ble5_ops-&gt;ext_upload_data(__ext_this-&gt;ext_scan_link-&gt;hw,<sp/>ll_ext_scan_rx_post);</highlight></codeline>
<codeline lineno="569"><highlight class="normal"></highlight><highlight class="preprocessor">#endif<sp/></highlight><highlight class="comment">/*<sp/>BLE5_FRAME_DEBUG<sp/>*/</highlight><highlight class="preprocessor"></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="570"><highlight class="normal"></highlight></codeline>
<codeline lineno="571"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>__ble5_ops-&gt;ext_ioctrl(__ext_this-&gt;ext_scan_link-&gt;hw,<sp/>BLE_GET_EXT_RX_EMPTY,<sp/>empty);</highlight></codeline>
<codeline lineno="572"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="573"><highlight class="normal">}</highlight></codeline>
<codeline lineno="574"><highlight class="normal"></highlight></codeline>
<codeline lineno="575"><highlight class="normal"><ref refid="ll__ext__scan_8c_1a163fc974f6617f7f5c44dec8f5390964" kindref="member">AT_BLE5_LL_CODE</ref></highlight></codeline>
<codeline lineno="576"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="ll__ext__scan_8h_1a20e06cdf14a775b8b694fe278c00b1aa" kindref="member">destroy_le_ext_scan</ref>(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="577"><highlight class="normal">{</highlight></codeline>
<codeline lineno="578"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//&lt;<sp/>creat<sp/>by<sp/>ble<sp/>hci,<sp/>remove<sp/>all<sp/>ext<sp/>scan<sp/>param</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="579"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="hci__ll__cmds_8c_1ae306cbc8d57487606be6ee2a0740747f" kindref="member">ext_le_param</ref>.<ref refid="structext__le__parameter_1a062d8a9b1f0d0758a92c305367fce9cf" kindref="member">ext_scan</ref>)<sp/>{</highlight></codeline>
<codeline lineno="580"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="hci__ll__cmds_8c_1ae306cbc8d57487606be6ee2a0740747f" kindref="member">ext_le_param</ref>.<ref refid="structext__le__parameter_1a062d8a9b1f0d0758a92c305367fce9cf" kindref="member">ext_scan</ref>-&gt;period_sync)<sp/>{</highlight></codeline>
<codeline lineno="581"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="periodic__advertising_8h_1ab7ae6278cd3c4c7cfb049d39c26c2ded" kindref="member">ll_periodic_advertising_terminate_sync</ref>(<ref refid="hci__ll__cmds_8c_1ae306cbc8d57487606be6ee2a0740747f" kindref="member">ext_le_param</ref>.<ref refid="structext__le__parameter_1a062d8a9b1f0d0758a92c305367fce9cf" kindref="member">ext_scan</ref>-&gt;period_sync-&gt;sync_handle);</highlight></codeline>
<codeline lineno="582"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="583"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>__bt_free(<ref refid="hci__ll__cmds_8c_1ae306cbc8d57487606be6ee2a0740747f" kindref="member">ext_le_param</ref>.<ref refid="structext__le__parameter_1a062d8a9b1f0d0758a92c305367fce9cf" kindref="member">ext_scan</ref>);</highlight></codeline>
<codeline lineno="584"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="hci__ll__cmds_8c_1ae306cbc8d57487606be6ee2a0740747f" kindref="member">ext_le_param</ref>.<ref refid="structext__le__parameter_1a062d8a9b1f0d0758a92c305367fce9cf" kindref="member">ext_scan</ref><sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="585"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="586"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//&lt;<sp/>creat<sp/>by<sp/>ll,<sp/>close<sp/>ext<sp/>scan<sp/>link</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="587"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="ll__ext__scan_8h_1ade4085d263f6f451ccd74a02e2f9f561" kindref="member">ll_ext_scan_close</ref>();</highlight></codeline>
<codeline lineno="588"><highlight class="normal">}</highlight></codeline>
<codeline lineno="589"><highlight class="normal"></highlight></codeline>
<codeline lineno="590"><highlight class="normal"><ref refid="ll__ext__scan_8c_1a163fc974f6617f7f5c44dec8f5390964" kindref="member">AT_BLE5_LL_CODE</ref></highlight></codeline>
<codeline lineno="591"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*<ref refid="ll__ext__scan_8h_1ad9eef021572c00f9f7f9f042c812f82a" kindref="member">ll_get_ext_scan_link</ref>(u16<sp/>sync_handle)</highlight></codeline>
<codeline lineno="592"><highlight class="normal">{</highlight></codeline>
<codeline lineno="593"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(__ext_this-&gt;ext_scan_link-&gt;period_sync)<sp/>{</highlight></codeline>
<codeline lineno="594"><highlight class="normal"></highlight></codeline>
<codeline lineno="595"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(__ext_this-&gt;ext_scan_link-&gt;period_sync-&gt;sync_handle<sp/>==<sp/>sync_handle)<sp/>{</highlight></codeline>
<codeline lineno="596"><highlight class="normal"></highlight></codeline>
<codeline lineno="597"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>__ext_this-&gt;ext_scan_link;</highlight></codeline>
<codeline lineno="598"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="599"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="600"><highlight class="normal"></highlight></codeline>
<codeline lineno="601"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="602"><highlight class="normal">}</highlight></codeline>
<codeline lineno="603"><highlight class="normal"></highlight></codeline>
<codeline lineno="604"><highlight class="normal"></highlight><highlight class="comment">/*-----------------------*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="605"><highlight class="normal"></highlight><highlight class="comment">/*</highlight></codeline>
<codeline lineno="606"><highlight class="comment"><sp/>*<sp/><sp/><sp/><sp/><sp/><sp/>Link<sp/>Layer<sp/>API</highlight></codeline>
<codeline lineno="607"><highlight class="comment"><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="608"><highlight class="normal"></highlight></codeline>
<codeline lineno="609"><highlight class="normal"><ref refid="ll__ext__scan_8c_1a163fc974f6617f7f5c44dec8f5390964" kindref="member">AT_BLE5_LL_CODE</ref></highlight></codeline>
<codeline lineno="610"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="ll__ext__scan_8h_1af4bfb24266d7b367c6661bf6265e1691" kindref="member">ll_ext_scan_open</ref>(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="611"><highlight class="normal">{</highlight></codeline>
<codeline lineno="612"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structle__ext__scan__link" kindref="compound">le_ext_scan_link</ref><sp/>*ext_scan_link;</highlight></codeline>
<codeline lineno="613"><highlight class="normal"></highlight></codeline>
<codeline lineno="614"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//&lt;<sp/>creat<sp/>secondary<sp/>scan</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="615"><highlight class="normal"><sp/><sp/><sp/><sp/>ext_scan_link<sp/>=<sp/>ll_create_ext_secondary_scan();</highlight></codeline>
<codeline lineno="616"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(NULL<sp/>==<sp/>ext_scan_link)<sp/>{</highlight></codeline>
<codeline lineno="617"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>MEMORY_CAPACITY_EXCEEDED;</highlight></codeline>
<codeline lineno="618"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="619"><highlight class="normal"></highlight></codeline>
<codeline lineno="620"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//&lt;<sp/>creat<sp/>primary<sp/>scan</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="621"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>status<sp/>=<sp/>ll_create_ext_primary_scan(ext_scan_link);</highlight></codeline>
<codeline lineno="622"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(status)<sp/>{</highlight></codeline>
<codeline lineno="623"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>status;</highlight></codeline>
<codeline lineno="624"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="625"><highlight class="normal"></highlight></codeline>
<codeline lineno="626"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//&lt;<sp/>create<sp/>duration<sp/>or<sp/>max<sp/>extended<sp/>advertising<sp/>events<sp/>timer</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="627"><highlight class="normal"><sp/><sp/><sp/><sp/>status<sp/>=<sp/>ll_ext_scan_create_duration_timer(ext_scan_link);</highlight></codeline>
<codeline lineno="628"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(status)<sp/>{</highlight></codeline>
<codeline lineno="629"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>status;</highlight></codeline>
<codeline lineno="630"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="631"><highlight class="normal"></highlight></codeline>
<codeline lineno="632"><highlight class="normal"><sp/><sp/><sp/><sp/>__set_ll_ext_scan_state(ext_scan_link);</highlight></codeline>
<codeline lineno="633"><highlight class="normal"></highlight></codeline>
<codeline lineno="634"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>SUCCESS;</highlight></codeline>
<codeline lineno="635"><highlight class="normal">}</highlight></codeline>
<codeline lineno="636"><highlight class="normal"></highlight></codeline>
<codeline lineno="637"><highlight class="normal"><ref refid="ll__ext__scan_8c_1a163fc974f6617f7f5c44dec8f5390964" kindref="member">AT_BLE5_LL_CODE</ref></highlight></codeline>
<codeline lineno="638"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="ll__ext__scan_8h_1ade4085d263f6f451ccd74a02e2f9f561" kindref="member">ll_ext_scan_close</ref>(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="639"><highlight class="normal">{</highlight></codeline>
<codeline lineno="640"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(NULL<sp/>==<sp/>__ext_this-&gt;ext_scan_link)<sp/>{</highlight></codeline>
<codeline lineno="641"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="642"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="643"><highlight class="normal"></highlight></codeline>
<codeline lineno="644"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//&lt;<sp/>remove<sp/>timeout<sp/>timer</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="645"><highlight class="normal"><sp/><sp/><sp/><sp/>ll_ext_scan_timeout_stop();</highlight></codeline>
<codeline lineno="646"><highlight class="normal"></highlight></codeline>
<codeline lineno="647"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*</highlight></codeline>
<codeline lineno="648"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>avoid<sp/>secondary<sp/>scan<sp/>event<sp/>isr<sp/>to<sp/>set<sp/>primary<sp/>not<sp/>hold<sp/>but<sp/>the<sp/>primary<sp/>already<sp/>close</highlight></codeline>
<codeline lineno="649"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="650"><highlight class="normal"><sp/><sp/><sp/><sp/>local_irq_disable();</highlight></codeline>
<codeline lineno="651"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//&lt;<sp/>destroy<sp/>ext<sp/>primary<sp/>scan<sp/>hw</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="652"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="ll__ext__scan_8h_1a7d55e23de39519e4fb9b904df0876790" kindref="member">LL_EXT_PUBLIC_PRIMARY_SCAN_DESTROY_PROCEDURE</ref>(__ext_this-&gt;ext_scan_link-&gt;primary_legacy_hw);</highlight></codeline>
<codeline lineno="653"><highlight class="normal"><sp/><sp/><sp/><sp/>local_irq_enable();</highlight></codeline>
<codeline lineno="654"><highlight class="normal"></highlight></codeline>
<codeline lineno="655"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//&lt;<sp/>destroy<sp/>ext<sp/>secondary<sp/>scan</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="656"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="extended__advertising_8h_1a41cfd30fc29fab68d65c3df6baa10dbd" kindref="member">__ll_ext_link_close</ref>(__ext_this-&gt;ext_scan_link,<sp/>__ext_this-&gt;ext_scan_link-&gt;hw);</highlight></codeline>
<codeline lineno="657"><highlight class="normal"></highlight></codeline>
<codeline lineno="658"><highlight class="normal"><sp/><sp/><sp/><sp/>__ext_this-&gt;ext_scan_link<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="659"><highlight class="normal">}</highlight></codeline>
<codeline lineno="660"><highlight class="normal"></highlight></codeline>
<codeline lineno="661"><highlight class="normal"></highlight></codeline>
<codeline lineno="662"><highlight class="normal"></highlight><highlight class="preprocessor">#endif<sp/></highlight><highlight class="comment">/*<sp/>BLUETOOTH_5<sp/>*/</highlight><highlight class="preprocessor"></highlight></codeline>
    </programlisting>
    <location file="/data/bingquan/repo/repo_adapter/adapter_sdk/lib/btctrler/BLE_v2/ll_ext_scan.c"/>
  </compounddef>
</doxygen>
